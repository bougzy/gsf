<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSAMS - GeoSecure Attendance Management System</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- QR Code library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --danger-color: #f72585;
            --warning-color: #f8961e;
            --dark-color: #212529;
            --light-color: #f8f9fa;
            --gray-color: #6c757d;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fb;
            color: var(--dark-color);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
        
        /* Navbar */
        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--primary-color) !important;
        }
        
        .navbar-brand i {
            color: var(--success-color);
        }
        
        .navbar {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 1rem 0;
            transition: var(--transition);
        }
        
        .navbar.scrolled {
            padding: 0.7rem 0;
            background-color: white !important;
        }
        
        .nav-link {
            font-weight: 500;
            margin: 0 0.5rem;
            transition: var(--transition);
        }
        
        .nav-link:hover {
            color: var(--primary-color) !important;
        }
        
        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, #4361ee 0%, #3f37c9 100%);
            color: white;
            padding: 8rem 0 6rem;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            top: -150px;
            right: -100px;
        }
        
        .hero-section::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            bottom: -100px;
            left: -50px;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }
        
        .hero-subtitle {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            max-width: 600px;
        }
        
        .hero-btns {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        /* Features Section */
        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            display: inline-block;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            width: 70px;
            height: 4px;
            background: var(--primary-color);
            bottom: -10px;
            left: 0;
            border-radius: 2px;
        }
        
        .section-subtitle {
            color: var(--gray-color);
            max-width: 700px;
            margin: 0 auto 4rem;
        }
        
        .feature-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            height: 100%;
            transition: var(--transition);
            box-shadow: var(--box-shadow);
            border: 1px solid #eee;
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
        }
        
        .feature-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            color: white;
            font-size: 1.8rem;
        }
        
        .feature-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        /* Add these styles to your existing CSS */

/* Meeting table enhancements */
.meeting-actions {
    display: flex;
    gap: 4px;
}

.meeting-actions .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
}

/* Validation progress indicator */
.validation-indicator {
    width: 60px;
    height: 5px;
    background: #e9ecef;
    border-radius: 3px;
    overflow: hidden;
    margin-top: 2px;
}

.validation-progress {
    height: 100%;
    background: linear-gradient(90deg, #4cc9f0, #4361ee);
    transition: width 0.3s ease;
}

/* Success modal animations */
@keyframes bounceIn {
    from {
        opacity: 0;
        transform: scale(0.5);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.success-icon {
    animation: bounceIn 0.6s ease;
}

/* Section validation states */
.form-section.valid {
    border-left: 4px solid #28a745;
    padding-left: 1rem;
}

.form-section.invalid {
    border-left: 4px solid #dc3545;
    padding-left: 1rem;
}

/* Required field indicator */
.required-field::after {
    content: " *";
    color: #dc3545;
}

/* Disabled button styling */
.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Meeting table highlight */
.table-success {
    background-color: rgba(40, 167, 69, 0.1) !important;
    transition: background-color 0.5s ease;
}

/* Section completion check */
.section-complete {
    color: #28a745;
}

.section-incomplete {
    color: #dc3545;
}
        
        /* Buttons */
        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 0.8rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-primary-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
            color: white;
        }
        
        .btn-outline-custom {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 0.8rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            transition: var(--transition);
            background: transparent;
        }
        
        .btn-outline-custom:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }
        
        /* Auth Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: linear-gradient(135deg, #f5f7fb 0%, #eef2ff 100%);
        }
        
        .auth-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 3rem;
            width: 100%;
            max-width: 500px;
        }
        
        .auth-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .auth-subtitle {
            color: var(--gray-color);
            margin-bottom: 2rem;
        }
        
        /* Dashboard */
        .dashboard-container {
            min-height: 100vh;
            background-color: #f5f7fb;
        }
        
        .sidebar {
            background: white;
            min-height: 100vh;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            position: fixed;
            width: 260px;
            transition: var(--transition);
            z-index: 100;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .sidebar-logo {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .sidebar-menu {
            padding: 1.5rem 0;
        }
        
        .sidebar-item {
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--dark-color);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
            cursor: pointer;
        }
        
        .sidebar-item:hover, .sidebar-item.active {
            background-color: #f0f4ff;
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }
        
        .sidebar-item i {
            width: 20px;
        }
        
        .main-content {
            margin-left: 260px;
            padding: 2rem;
            transition: var(--transition);
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        /* Stats Cards */
        .stats-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border: 1px solid #eee;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stats-title {
            color: var(--gray-color);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Tables */
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }
        
        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Forms */
        .form-control, .form-select {
            border-radius: 10px;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            transition: var(--transition);
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
        }
        
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        /* Badges */
        .badge-custom {
            padding: 0.4rem 0.8rem;
            border-radius: 50px;
            font-weight: 500;
            font-size: 0.8rem;
        }
        
        /* Modal */
        .modal-custom {
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        .modal-header-custom {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
        }
        
        /* Toggle Sidebar Button */
        .toggle-sidebar {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        /* New styles for meeting sharing features */
        .share-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid #dee2e6;
        }
        
        .share-link-container {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #e0e0e0;
        }
        
        .share-link {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            font-family: monospace;
            word-break: break-all;
            font-size: 0.9rem;
            border: 1px dashed #ccc;
        }
        
        .qr-code-container {
            text-align: center;
            padding: 1.5rem;
            background: white;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .qr-code-canvas {
            max-width: 250px;
            height: auto;
            margin: 0 auto;
        }
        
        .form-builder-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid #eee;
            box-shadow: var(--box-shadow);
        }
        
        .form-field-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #dee2e6;
            transition: var(--transition);
        }
        
        .form-field-item:hover {
            background: #e9ecef;
        }
        
        .field-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .preview-form {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            border: 2px dashed #dee2e6;
        }
        
        /* Modal adjustments for new features */
        .modal-xl {
            max-width: 1200px;
        }
        
        /* Real-time monitoring styles */
        .monitoring-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .live-badge {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .location-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        
        .location-good { background-color: #28a745; }
        .location-fair { background-color: #ffc107; }
        .location-poor { background-color: #dc3545; }
        
        .time-indicator {
            height: 6px;
            border-radius: 3px;
            margin-top: 5px;
            background: linear-gradient(90deg, #28a745 0%, #ffc107 50%, #dc3545 100%);
        }
        
        /* PWA Install Button */
        .pwa-install-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: none;
        }
        
        /* Attendance card styles */
        .attendance-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .attendance-card.gps { border-left-color: #4361ee; }
        .attendance-card.sms { border-left-color: #20c997; }
        .attendance-card.ussd { border-left-color: #fd7e14; }
        .attendance-card.kiosk { border-left-color: #6f42c1; }
        .attendance-card.manual { border-left-color: #17a2b8; }
        
        /* Confidence indicator */
        .confidence-bar {
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        
        /* Export buttons */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .export-card {
            text-align: center;
            padding: 2rem 1rem;
            border-radius: var(--border-radius);
            background: white;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .export-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }
            
            .sidebar.active {
                transform: translateX(0);
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            }
            
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .toggle-sidebar {
                display: block;
            }
            
            .hero-title {
                font-size: 2.8rem;
            }
            
            /* Overlay for sidebar on mobile */
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 99;
            }
            
            .sidebar-overlay.active {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.2rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .auth-card {
                padding: 2rem;
            }
            
            .top-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .user-menu {
                align-self: flex-end;
            }
            
            .export-options {
                grid-template-columns: 1fr;
            }
        }
        
        /* Loading Spinner */
        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Footer */
        .footer {
            background: var(--dark-color);
            color: white;
            padding: 4rem 0 2rem;
        }
        
        .footer-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
        }
        
        .footer-links li {
            margin-bottom: 0.8rem;
        }
        
        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-links a:hover {
            color: white;
            padding-left: 5px;
        }
        
        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid #444;
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast-custom {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border-left: 5px solid var(--primary-color);
            overflow: hidden;
            margin-bottom: 1rem;
            max-width: 350px;
            animation: slideInRight 0.3s ease;
        }
        
        .toast-header-custom {
            padding: 1rem;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .toast-body-custom {
            padding: 1rem;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Close sidebar on mobile after click */
        .sidebar-close {
            display: none;
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-color);
        }
        
        @media (max-width: 992px) {
            .sidebar-close {
                display: block;
            }
        }
        
        /* Live feed styles */
        .live-feed-container {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .live-feed-item {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }
        
        .live-feed-item:hover {
            background-color: #f8f9fa;
        }
        
        .live-feed-item.new {
            background-color: rgba(76, 201, 240, 0.1);
            animation: highlight 2s ease;
        }
        
        @keyframes highlight {
            0% { background-color: rgba(76, 201, 240, 0.3); }
            100% { background-color: rgba(76, 201, 240, 0.1); }
        }
        
        /* Location test panel */
        .location-test-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .location-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .location-status.valid {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
        }
        
        .location-status.invalid {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid #dc3545;
        }
        
        /* PWA banner */
        .pwa-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #4361ee 0%, #3f37c9 100%);
            color: white;
            padding: 1rem;
            display: none;
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .pwa-banner.show {
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="spinner-container">
        <div class="spinner"></div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- PWA Install Button -->
    <button id="pwaInstallBtn" class="btn btn-primary-custom pwa-install-btn" style="display: none;">
        <i class="fas fa-download me-2"></i> Install App
    </button>

    <!-- PWA Banner -->
    <div id="pwaBanner" class="pwa-banner">
        <div>
            <strong>Install GSAMS App</strong>
            <p class="mb-0 small">Get better experience with our PWA</p>
        </div>
        <div>
            <button class="btn btn-light btn-sm me-2" onclick="dismissPwaBanner()">Later</button>
            <button class="btn btn-primary-custom btn-sm" onclick="installPWA()">Install</button>
        </div>
    </div>

    <!-- Sidebar overlay for mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <!-- Home Page -->
    <div id="homePage">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-map-marker-alt"></i> GSAMS
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#home">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#features">Features</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#how-it-works">How It Works</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#contact">Contact</a>
                        </li>
                        <li class="nav-item ms-2">
                            <button class="btn btn-outline-custom" onclick="showPage('login')">Login</button>
                        </li>
                        <li class="nav-item">
                            <button class="btn btn-primary-custom" onclick="showPage('register')">Get Started</button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero-section" id="home">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6" data-aos="fade-right">
                        <h1 class="hero-title">GeoSecure Attendance Management System</h1>
                        <p class="hero-subtitle">
                            A comprehensive solution for secure, location-based attendance tracking using GPS, SMS, USSD, and QR codes. Perfect for events, meetings, and employee tracking.
                        </p>
                        <div class="hero-btns">
                            <button class="btn btn-primary-custom" onclick="showPage('register')">
                                <i class="fas fa-rocket me-2"></i> Start Free Trial
                            </button>
                            <button class="btn btn-outline-custom" style="border-color: white; color: white;" onclick="showPage('login')">
                                <i class="fas fa-sign-in-alt me-2"></i> Admin Login
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-6" data-aos="fade-left">
                        <div class="text-center mt-5 mt-lg-0">
                            <img src="https://cdn.pixabay.com/photo/2017/08/06/00/18/people-2587399_1280.jpg" class="img-fluid rounded-3 shadow-lg" alt="Attendance Management" style="max-height: 400px;">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="py-5 my-5" id="features">
            <div class="container">
                <div class="text-center mb-5">
                    <h2 class="section-title text-center">Powerful Features</h2>
                    <p class="section-subtitle text-center">
                        GSAMS provides multiple verification methods to ensure accurate attendance tracking in any situation
                    </p>
                </div>
                <div class="row g-4">
                    <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="100">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <h4 class="feature-title">GPS Location Verification</h4>
                            <p class="text-muted">
                                Verify attendance using smartphone GPS with radius-based validation. Get real-time location data with accuracy metrics.
                            </p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="200">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-sms"></i>
                            </div>
                            <h4 class="feature-title">SMS Attendance</h4>
                            <p class="text-muted">
                                Allow attendance via SMS for basic phones. Simple format: "ATTEND [CODE] [NAME]" to register attendance.
                            </p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="300">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <h4 class="feature-title">USSD Integration</h4>
                            <p class="text-muted">
                                Interactive USSD menus for attendance registration without internet access. Works on all mobile devices.
                            </p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="400">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-qrcode"></i>
                            </div>
                            <h4 class="feature-title">QR Code Check-in</h4>
                            <p class="text-muted">
                                Generate unique QR codes for each meeting. Participants scan with their smartphones for instant check-in.
                            </p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="500">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <h4 class="feature-title">Manual & Kiosk Mode</h4>
                            <p class="text-muted">
                                Admin-assisted check-ins and kiosk stations for events. Perfect for conferences and large gatherings.
                            </p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="600">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <h4 class="feature-title">Advanced Analytics</h4>
                            <p class="text-muted">
                                Comprehensive reports, export to PDF/Excel, real-time dashboards, and audit logs for complete transparency.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works -->
        <section class="py-5 my-5 bg-light" id="how-it-works">
            <div class="container">
                <div class="text-center mb-5">
                    <h2 class="section-title text-center">How It Works</h2>
                    <p class="section-subtitle text-center">
                        Simple four-step process to manage attendance for any event or meeting
                    </p>
                </div>
                <div class="row g-4">
                    <div class="col-md-6 col-lg-3" data-aos="fade-up">
                        <div class="text-center p-4">
                            <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                                <i class="fas fa-calendar-plus fa-2x"></i>
                            </div>
                            <h4>1. Create Meeting</h4>
                            <p class="text-muted">Set up meeting details, location, time window, and choose verification methods.</p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3" data-aos="fade-up" data-aos-delay="100">
                        <div class="text-center p-4">
                            <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                                <i class="fas fa-broadcast-tower fa-2x"></i>
                            </div>
                            <h4>2. Share Access</h4>
                            <p class="text-muted">Share meeting codes via QR, SMS, or USSD with your attendees.</p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3" data-aos="fade-up" data-aos-delay="200">
                        <div class="text-center p-4">
                            <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                                <i class="fas fa-user-check fa-2x"></i>
                            </div>
                            <h4>3. Attendance Collection</h4>
                            <p class="text-muted">Attendees check-in using their preferred method. All methods are validated.</p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3" data-aos="fade-up" data-aos-delay="300">
                        <div class="text-center p-4">
                            <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                                <i class="fas fa-chart-pie fa-2x"></i>
                            </div>
                            <h4>4. Analytics & Reports</h4>
                            <p class="text-muted">View real-time attendance, generate reports, export data for analysis.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="py-5 my-5">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 text-center" data-aos="zoom-in">
                        <h2 class="mb-4">Ready to Transform Your Attendance Management?</h2>
                        <p class="mb-4">Join thousands of organizations using GSAMS for secure, reliable attendance tracking.</p>
                        <button class="btn btn-primary-custom btn-lg" onclick="showPage('register')">
                            <i class="fas fa-rocket me-2"></i> Start Your Free Trial Today
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer" id="contact">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <h3 class="footer-title">
                            <i class="fas fa-map-marker-alt"></i> GSAMS
                        </h3>
                        <p class="mb-4">GeoSecure Attendance Management System provides secure, location-based attendance tracking for organizations of all sizes.</p>
                        <div class="d-flex gap-3">
                            <a href="#" class="text-white"><i class="fab fa-facebook fa-lg"></i></a>
                            <a href="#" class="text-white"><i class="fab fa-twitter fa-lg"></i></a>
                            <a href="#" class="text-white"><i class="fab fa-linkedin fa-lg"></i></a>
                            <a href="#" class="text-white"><i class="fab fa-instagram fa-lg"></i></a>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-6 mb-4 mb-md-0">
                        <h4 class="footer-title">Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="#home">Home</a></li>
                            <li><a href="#features">Features</a></li>
                            <li><a href="#how-it-works">How It Works</a></li>
                            <li><a href="#" onclick="showPage('login')">Login</a></li>
                            <li><a href="#" onclick="showPage('register')">Register</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                        <h4 class="footer-title">Features</h4>
                        <ul class="footer-links">
                            <li><a href="#">GPS Verification</a></li>
                            <li><a href="#">SMS Attendance</a></li>
                            <li><a href="#">USSD Integration</a></li>
                            <li><a href="#">QR Codes</a></li>
                            <li><a href="#">Analytics & Reports</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <h4 class="footer-title">Contact Us</h4>
                        <ul class="footer-links">
                            <li><i class="fas fa-envelope me-2"></i> support@gsams.com</li>
                            <li><i class="fas fa-phone me-2"></i> +1 (555) 123-4567</li>
                            <li><i class="fas fa-map-marker-alt me-2"></i> 123 Business Ave, Suite 100<br>New York, NY 10001</li>
                        </ul>
                    </div>
                </div>
                <div class="copyright">
                    <p>&copy; 2023 GSAMS - GeoSecure Attendance Management System. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="auth-container" style="display: none;">
        <div class="auth-card">
            <div class="text-center mb-4">
                <h2 class="auth-title">Create Account</h2>
                <p class="auth-subtitle">Sign up for your GSAMS admin account</p>
            </div>
            
            <form id="registerForm">
                <div class="mb-3">
                    <label for="regOrganizationName" class="form-label">Organization Name</label>
                    <input type="text" class="form-control" id="regOrganizationName" required>
                </div>
                
                <div class="mb-3">
                    <label for="regFullName" class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="regFullName" required>
                </div>
                
                <div class="mb-3">
                    <label for="regEmail" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="regEmail" required>
                </div>
                
                <div class="mb-3">
                    <label for="regPhone" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="regPhone">
                </div>
                
                <div class="mb-3">
                    <label for="regPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="regPassword" required>
                </div>
                
                <div class="mb-4">
                    <label for="regConfirmPassword" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="regConfirmPassword" required>
                </div>
                
                <div class="d-grid gap-2 mb-3">
                    <button type="submit" class="btn btn-primary-custom">
                        <i class="fas fa-user-plus me-2"></i> Create Account
                    </button>
                </div>
                
                <div class="text-center">
                    <p class="mb-0">Already have an account? <a href="#" class="text-primary" onclick="showPage('login')">Login here</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="auth-container" style="display: none;">
        <div class="auth-card">
            <div class="text-center mb-4">
                <h2 class="auth-title">Admin Login</h2>
                <p class="auth-subtitle">Sign in to your GSAMS dashboard</p>
            </div>
            
            <form id="loginForm">
                <div class="mb-3">
                    <label for="loginEmail" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="loginEmail" required>
                </div>
                
                <div class="mb-4">
                    <label for="loginPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="loginPassword" required>
                </div>
                
                <div class="d-grid gap-2 mb-3">
                    <button type="submit" class="btn btn-primary-custom">
                        <i class="fas fa-sign-in-alt me-2"></i> Sign In
                    </button>
                </div>
                
                <div class="text-center">
                    <p class="mb-0">Don't have an account? <a href="#" class="text-primary" onclick="showPage('register')">Register here</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-map-marker-alt me-2"></i> GSAMS
                </div>
                <button class="sidebar-close" onclick="closeSidebar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item active" onclick="showDashboardSection('dashboard-home')">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('meetings')">
                    <i class="fas fa-calendar-alt"></i> Meetings
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('attendance')">
                    <i class="fas fa-user-check"></i> Attendance
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('reports')">
                    <i class="fas fa-chart-bar"></i> Reports
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('admins')">
                    <i class="fas fa-users-cog"></i> Admins
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('settings')">
                    <i class="fas fa-cog"></i> Settings
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('audit-logs')">
                    <i class="fas fa-clipboard-list"></i> Audit Logs
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('location-test')">
                    <i class="fas fa-map-marker-alt"></i> Location Test
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('pwa-settings')">
                    <i class="fas fa-mobile-alt"></i> PWA Settings
                </a>
                
                <div class="mt-5 px-3">
                    <hr>
                    <a href="#" class="sidebar-item" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="d-flex align-items-center">
                    <button class="toggle-sidebar me-3" id="toggleSidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h3 class="page-title" id="pageTitle">Dashboard</h3>
                </div>
                
                <div class="user-menu">
                    <div class="d-flex align-items-center">
                        <div class="user-avatar me-2" id="userAvatar">JD</div>
                        <div>
                            <h6 class="mb-0" id="userName">John Doe</h6>
                            <small class="text-muted" id="userRole">Super Admin</small>
                        </div>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i> Profile</a></li>
                            <li><a class="dropdown-item" href="#" onclick="showDashboardSection('settings')"><i class="fas fa-cog me-2"></i> Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Content -->
            <div id="dashboard-content">
                <!-- Dashboard Home -->
                <div id="dashboard-home" class="dashboard-section">
                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="stats-card">
                                <div class="stats-icon bg-primary text-white">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <h3 class="stats-number" id="totalMeetings">0</h3>
                                <p class="stats-title">Total Meetings</p>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="stats-card">
                                <div class="stats-icon bg-success text-white">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <h3 class="stats-number" id="activeMeetings">0</h3>
                                <p class="stats-title">Active Meetings</p>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="stats-card">
                                <div class="stats-icon bg-warning text-white">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h3 class="stats-number" id="totalAttendance">0</h3>
                                <p class="stats-title">Total Attendance</p>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="stats-card">
                                <div class="stats-icon bg-danger text-white">
                                    <i class="fas fa-user-clock"></i>
                                </div>
                                <h3 class="stats-number" id="todayAttendance">0</h3>
                                <p class="stats-title">Today's Attendance</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-lg-8">
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">Real-time Monitoring</h5>
                                    <span class="badge bg-danger live-badge">LIVE</span>
                                </div>
                                <div class="p-3">
                                    <div class="row text-center">
                                        <div class="col-md-4 mb-3">
                                            <div class="p-3 bg-light rounded">
                                                <h4 id="liveAttendees">0</h4>
                                                <small class="text-muted">Active Attendees</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="p-3 bg-light rounded">
                                                <h4 id="liveMeetings">0</h4>
                                                <small class="text-muted">Active Meetings</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="p-3 bg-light rounded">
                                                <h4 id="liveVerified">0</h4>
                                                <small class="text-muted">Verified Today</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="live-feed-container" id="liveFeed">
                                        <!-- Live attendance feed will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">Attendance by Type</h5>
                                </div>
                                <div class="p-3">
                                    <canvas id="attendanceChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-8 mb-4">
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">Recent Attendance</h5>
                                    <a href="#" class="btn btn-sm btn-outline-custom" onclick="showDashboardSection('attendance')">View All</a>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Meeting</th>
                                                <th>Method</th>
                                                <th>Time</th>
                                                <th>Status</th>
                                                <th>Confidence</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentAttendance">
                                            <!-- Filled by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4 mb-4">
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">Quick Actions</h5>
                                </div>
                                <div class="p-3">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary-custom" onclick="showCreateMeetingModal()">
                                            <i class="fas fa-plus me-2"></i> Create Meeting
                                        </button>
                                        <button class="btn btn-outline-custom" onclick="showLocationTestModal()">
                                            <i class="fas fa-map-marker-alt me-2"></i> Test Location
                                        </button>
                                        <button class="btn btn-outline-custom" onclick="exportAllMeetings()">
                                            <i class="fas fa-download me-2"></i> Export All Data
                                        </button>
                                        <button class="btn btn-outline-custom" onclick="showDashboardSection('pwa-settings')">
                                            <i class="fas fa-mobile-alt me-2"></i> PWA Settings
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Meetings Section -->
                <div id="meetings" class="dashboard-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4>Meetings Management</h4>
                        <button class="btn btn-primary-custom" onclick="showCreateMeetingModal()">
                            <i class="fas fa-plus me-2"></i> Create New Meeting
                        </button>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="meetingStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="draft">Draft</option>
                                    <option value="active">Active</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="form-group">
                                <label class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="meetingStartDate">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="form-group">
                                <label class="form-label">End Date</label>
                                <input type="date" class="form-control" id="meetingEndDate">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3 mb-3 d-flex align-items-end">
                            <button class="btn btn-primary-custom w-100" onclick="loadMeetings()">
                                <i class="fas fa-filter me-2"></i> Filter
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Date & Time</th>
                                        <th>Location</th>
                                        <th>Attendance Methods</th>
                                        <th>Status</th>
                                        <th>Attendees</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="meetingsTable">
                                    <!-- Filled by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Attendance Section -->
                <div id="attendance" class="dashboard-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4>Attendance Records</h4>
                        <div class="btn-group">
                            <button class="btn btn-outline-custom" onclick="exportAllAttendance()">
                                <i class="fas fa-download me-2"></i> Export All
                            </button>
                            <button class="btn btn-primary-custom" onclick="showRealTimeMonitoring()">
                                <i class="fas fa-eye me-2"></i> Live View
                            </button>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label class="form-label">Meeting</label>
                                <select class="form-select" id="attendanceMeetingFilter">
                                    <option value="">All Meetings</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label class="form-label">Verification Type</label>
                                <select class="form-select" id="attendanceTypeFilter">
                                    <option value="">All Types</option>
                                    <option value="smartphone_gps">GPS</option>
                                    <option value="sms">SMS</option>
                                    <option value="ussd">USSD</option>
                                    <option value="kiosk">Kiosk</option>
                                    <option value="manual">Manual</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="attendanceStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="verified">Verified</option>
                                    <option value="flagged">Flagged</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Meeting</th>
                                        <th>Method</th>
                                        <th>Check-in Time</th>
                                        <th>Location</th>
                                        <th>Confidence</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceTable">
                                    <!-- Filled by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Section -->
                <div id="reports" class="dashboard-section" style="display: none;">
                    <h4 class="mb-4">Reports & Analytics</h4>
                    
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">Analytics Dashboard</h5>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline-custom" onclick="loadAnalytics('day')">Today</button>
                                        <button class="btn btn-sm btn-outline-custom" onclick="loadAnalytics('week')">Week</button>
                                        <button class="btn btn-sm btn-outline-custom" onclick="loadAnalytics('month')">Month</button>
                                        <button class="btn btn-sm btn-outline-custom" onclick="loadAnalytics('year')">Year</button>
                                    </div>
                                </div>
                                <div class="p-3">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <canvas id="trendChart" height="200"></canvas>
                                        </div>
                                        <div class="col-md-6">
                                            <canvas id="methodChart" height="200"></canvas>
                                        </div>
                                    </div>
                                    <div class="mt-4">
                                        <h6>Location Analytics</h6>
                                        <div id="locationAnalytics">
                                            <!-- Location analytics will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">Export Options</h5>
                                </div>
                                <div class="p-4">
                                    <div class="export-options">
                                        <div class="export-card" onclick="exportReport('pdf')">
                                            <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                            <h5>Export to PDF</h5>
                                            <p class="text-muted small">Professional PDF reports with attendance details</p>
                                        </div>
                                        <div class="export-card" onclick="exportReport('excel')">
                                            <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                                            <h5>Export to Excel</h5>
                                            <p class="text-muted small">Detailed spreadsheets for analysis</p>
                                        </div>
                                        <div class="export-card" onclick="exportAllMeetingsReport()">
                                            <i class="fas fa-file-archive fa-3x text-warning mb-3"></i>
                                            <h5>All Meetings Report</h5>
                                            <p class="text-muted small">Complete organization report</p>
                                        </div>
                                        <div class="export-card" onclick="exportLocationAnalytics()">
                                            <i class="fas fa-map-marked-alt fa-3x text-primary mb-3"></i>
                                            <h5>Location Analytics</h5>
                                            <p class="text-muted small">GPS and location data analysis</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Admins Section -->
                <div id="admins" class="dashboard-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4>Admin Management</h4>
                        <button class="btn btn-primary-custom" onclick="showCreateAdminModal()">
                            <i class="fas fa-user-plus me-2"></i> Add Admin
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Role</th>
                                        <th>Permissions</th>
                                        <th>Status</th>
                                        <th>Last Login</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="adminsTable">
                                    <!-- Filled by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Section -->
                <div id="settings" class="dashboard-section" style="display: none;">
                    <h4 class="mb-4">Organization Settings</h4>
                    
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">Attendance Settings</h5>
                                </div>
                                <div class="p-4">
                                    <form id="settingsForm">
                                        <div class="row mb-4">
                                            <div class="col-md-6">
                                                <label class="form-label">Default Location Radius (meters)</label>
                                                <input type="number" class="form-control" id="defaultRadius" value="100" min="10" max="1000">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Default Time Window (minutes)</label>
                                                <input type="number" class="form-control" id="defaultTimeWindow" value="30" min="5" max="120">
                                            </div>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">Allowed Attendance Methods</label>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" id="allowGPS" checked>
                                                        <label class="form-check-label" for="allowGPS">
                                                            <i class="fas fa-map-marker-alt me-2"></i> Smartphone GPS
                                                        </label>
                                                    </div>
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" id="allowSMS" checked>
                                                        <label class="form-check-label" for="allowSMS">
                                                            <i class="fas fa-sms me-2"></i> SMS
                                                        </label>
                                                    </div>
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" id="allowUSSD" checked>
                                                        <label class="form-check-label" for="allowUSSD">
                                                            <i class="fas fa-mobile-alt me-2"></i> USSD
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" id="allowKiosk" checked>
                                                        <label class="form-check-label" for="allowKiosk">
                                                            <i class="fas fa-desktop me-2"></i> Kiosk
                                                        </label>
                                                    </div>
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" id="allowManual" checked>
                                                        <label class="form-check-label" for="allowManual">
                                                            <i class="fas fa-user-check me-2"></i> Manual
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">Verification Strictness</label>
                                            <select class="form-select" id="verificationStrictness">
                                                <option value="low">Low - Relaxed verification</option>
                                                <option value="medium" selected>Medium - Balanced verification</option>
                                                <option value="high">High - Strict verification</option>
                                            </select>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">Duplicate Prevention</label>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="preventSameDevice" checked>
                                                <label class="form-check-label" for="preventSameDevice">
                                                    Prevent same device check-ins
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="preventSamePhone" checked>
                                                <label class="form-check-label" for="preventSamePhone">
                                                    Prevent same phone number check-ins
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="preventSameNameTime" checked>
                                                <label class="form-check-label" for="preventSameNameTime">
                                                    Prevent same name within time window
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary-custom">
                                            <i class="fas fa-save me-2"></i> Save Settings
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="table-container mb-4">
                                <div class="table-header">
                                    <h5 class="mb-0">Organization Info</h5>
                                </div>
                                <div class="p-4">
                                    <div class="mb-3">
                                        <label class="form-label">Organization Name</label>
                                        <p class="fw-bold" id="orgName">GSAMS Organization</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Domain</label>
                                        <p class="fw-bold" id="orgDomain">example.com</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Created On</label>
                                        <p class="fw-bold" id="orgCreated">2023-01-01</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Status</label>
                                        <span class="badge bg-success" id="orgStatus">Active</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">API Information</h5>
                                </div>
                                <div class="p-4">
                                    <p class="small text-muted mb-3">Use these endpoints to integrate with your applications:</p>
                                    <div class="mb-3">
                                        <label class="form-label small">Base URL</label>
                                        <code class="d-block p-2 bg-light rounded" id="apiBaseUrl">https://gsb-hrs3.onrender.com/api</code>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small">Your API Key</label>
                                        <code class="d-block p-2 bg-light rounded" id="apiKey">***************</code>
                                    </div>
                                    <button class="btn btn-sm btn-outline-custom w-100" onclick="regenerateApiKey()">
                                        <i class="fas fa-sync-alt me-2"></i> Regenerate API Key
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Audit Logs Section -->
                <div id="audit-logs" class="dashboard-section" style="display: none;">
                    <h4 class="mb-4">Audit Logs</h4>
                    
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="form-group">
                                <label class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="auditStartDate">
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="form-group">
                                <label class="form-label">End Date</label>
                                <input type="date" class="form-control" id="auditEndDate">
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="form-group">
                                <label class="form-label">Action</label>
                                <select class="form-select" id="auditActionFilter">
                                    <option value="">All Actions</option>
                                    <option value="USER_LOGIN">User Login</option>
                                    <option value="MEETING_CREATED">Meeting Created</option>
                                    <option value="ATTENDANCE_STATUS_UPDATED">Attendance Updated</option>
                                    <option value="EXPORT_PDF">PDF Export</option>
                                    <option value="EXPORT_EXCEL">Excel Export</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="form-group">
                                <label class="form-label">User</label>
                                <select class="form-select" id="auditUserFilter">
                                    <option value="">All Users</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>User</th>
                                        <th>Action</th>
                                        <th>Entity</th>
                                        <th>Details</th>
                                        <th>IP Address</th>
                                    </tr>
                                </thead>
                                <tbody id="auditLogsTable">
                                    <!-- Filled by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Location Test Section -->
                <div id="location-test" class="dashboard-section" style="display: none;">
                    <div class="location-test-panel">
                        <h4 class="mb-4">Location Testing & Verification</h4>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">Meeting Code</label>
                                    <input type="text" class="form-control" id="testMeetingCode" placeholder="Enter meeting code">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">Or Select Meeting</label>
                                    <select class="form-select" id="testMeetingSelect">
                                        <option value="">Select a meeting</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">Latitude</label>
                                    <input type="number" step="any" class="form-control" id="testLatitude" placeholder="Enter latitude">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">Longitude</label>
                                    <input type="number" step="any" class="form-control" id="testLongitude" placeholder="Enter longitude">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">Accuracy (meters)</label>
                                    <input type="number" class="form-control" id="testAccuracy" value="10" min="1" max="1000">
                                </div>
                            </div>
                            <div class="col-md-6 d-flex align-items-end">
                                <button class="btn btn-primary-custom w-100" onclick="testLocation()">
                                    <i class="fas fa-map-marker-alt me-2"></i> Test Location
                                </button>
                            </div>
                        </div>
                        
                        <div id="locationTestResult" class="d-none">
                            <!-- Test results will be displayed here -->
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h5 class="mb-0">Location Verification History</h5>
                        </div>
                        <div class="p-3">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Meeting</th>
                                            <th>Test Time</th>
                                            <th>Coordinates</th>
                                            <th>Distance</th>
                                            <th>Accuracy</th>
                                            <th>Result</th>
                                            <th>Details</th>
                                        </tr>
                                    </thead>
                                    <tbody id="locationTestHistory">
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- PWA Settings Section -->
                <div id="pwa-settings" class="dashboard-section" style="display: none;">
                    <h4 class="mb-4">PWA & Mobile Settings</h4>
                    
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="table-container mb-4">
                                <div class="table-header">
                                    <h5 class="mb-0">Progressive Web App Settings</h5>
                                </div>
                                <div class="p-4">
                                    <div class="mb-4">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="enablePWA" checked>
                                            <label class="form-check-label" for="enablePWA">
                                                <strong>Enable PWA Features</strong>
                                            </label>
                                        </div>
                                        <p class="text-muted small">When enabled, users can install the app on their devices for better experience.</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label class="form-label">App Name</label>
                                        <input type="text" class="form-control" id="pwaAppName" value="GSAMS Attendance">
                                    </div>
                                    
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label class="form-label">Theme Color</label>
                                            <input type="color" class="form-control form-control-color" id="pwaThemeColor" value="#2196F3">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Background Color</label>
                                            <input type="color" class="form-control form-control-color" id="pwaBackgroundColor" value="#ffffff">
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label class="form-label">Push Notifications</label>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="pwaPushNewAttendance" checked>
                                            <label class="form-check-label" for="pwaPushNewAttendance">
                                                Notify on new attendance
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="pwaPushMeetingStart">
                                            <label class="form-check-label" for="pwaPushMeetingStart">
                                                Notify when meeting starts
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="pwaPushReminders">
                                            <label class="form-check-label" for="pwaPushReminders">
                                                Send attendance reminders
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-primary-custom" onclick="savePwaSettings()">
                                        <i class="fas fa-save me-2"></i> Save PWA Settings
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">Device Registration</h5>
                                </div>
                                <div class="p-4">
                                    <p class="text-muted mb-3">Registered devices for push notifications:</p>
                                    <div id="registeredDevices">
                                        <!-- Registered devices will be listed here -->
                                    </div>
                                    <button class="btn btn-outline-custom w-100 mt-3" onclick="registerCurrentDevice()">
                                        <i class="fas fa-mobile-alt me-2"></i> Register This Device
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="table-container mb-4">
                                <div class="table-header">
                                    <h5 class="mb-0">PWA Preview</h5>
                                </div>
                                <div class="p-4 text-center">
                                    <div class="mb-4">
                                        <div class="bg-light rounded p-4 d-inline-block">
                                            <div class="mb-3">
                                                <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                                    <i class="fas fa-map-marker-alt fa-2x text-white"></i>
                                                </div>
                                            </div>
                                            <h5 id="pwaPreviewName">GSAMS Attendance</h5>
                                            <p class="text-muted small">GeoSecure Attendance Management</p>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <h6>Installation Status</h6>
                                        <div id="pwaInstallStatus">
                                            <span class="badge bg-secondary">Checking...</span>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary-custom" onclick="installPWA()" id="installPwaBtn">
                                            <i class="fas fa-download me-2"></i> Install PWA
                                        </button>
                                        <button class="btn btn-outline-custom" onclick="testPushNotification()">
                                            <i class="fas fa-bell me-2"></i> Test Notification
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <div class="table-header">
                                    <h5 class="mb-0">Offline Capabilities</h5>
                                </div>
                                <div class="p-4">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span>Cache Storage</span>
                                            <span id="cacheSize">0 KB</span>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar" id="cacheProgress" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="enableOffline" checked>
                                            <label class="form-check-label" for="enableOffline">
                                                Enable offline mode
                                            </label>
                                        </div>
                                        <p class="text-muted small mb-0">Store data locally for offline access</p>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-custom" onclick="clearCache()">
                                            <i class="fas fa-trash me-2"></i> Clear Cache
                                        </button>
                                        <button class="btn btn-outline-custom" onclick="updateCache()">
                                            <i class="fas fa-sync-alt me-2"></i> Update Cache
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Create Meeting Modal -->
    <div class="modal fade" id="createMeetingModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content modal-custom">
                <div class="modal-header modal-header-custom">
                    <h5 class="modal-title">Create New Meeting</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="meetingTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab">Meeting Details</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="form-tab" data-bs-toggle="tab" data-bs-target="#form" type="button" role="tab">Attendance Form</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="sharing-tab" data-bs-toggle="tab" data-bs-target="#sharing" type="button" role="tab">Share & QR Code</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button" role="tab">Advanced Settings</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content mt-4" id="meetingTabsContent">
                        <!-- Tab 1: Meeting Details -->
                        <div class="tab-pane fade show active" id="details" role="tabpanel">
                            <form id="createMeetingForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Meeting Title *</label>
                                        <input type="text" class="form-control" id="meetingTitle" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Location Name *</label>
                                        <input type="text" class="form-control" id="meetingLocationName" required>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Description</label>
                                    <textarea class="form-control" id="meetingDescription" rows="3"></textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Start Date & Time *</label>
                                        <input type="datetime-local" class="form-control" id="meetingStartTime" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">End Date & Time *</label>
                                        <input type="datetime-local" class="form-control" id="meetingEndTime" required>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Latitude *</label>
                                        <input type="number" step="any" class="form-control" id="meetingLatitude" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Longitude *</label>
                                        <input type="number" step="any" class="form-control" id="meetingLongitude" required>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Location Radius (meters)</label>
                                        <input type="number" class="form-control" id="meetingRadius" value="100" min="10" max="1000">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Location Address</label>
                                        <input type="text" class="form-control" id="meetingAddress" placeholder="Street address, city, country">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Attendance Methods</label>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="allowGPSMeeting" checked>
                                                <label class="form-check-label" for="allowGPSMeeting">
                                                    <i class="fas fa-map-marker-alt me-2"></i> Smartphone GPS
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="allowSMSMeeting" checked>
                                                <label class="form-check-label" for="allowSMSMeeting">
                                                    <i class="fas fa-sms me-2"></i> SMS
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="allowUSSDMeeting" checked>
                                                <label class="form-check-label" for="allowUSSDMeeting">
                                                    <i class="fas fa-mobile-alt me-2"></i> USSD
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="allowKioskMeeting" checked>
                                                <label class="form-check-label" for="allowKioskMeeting">
                                                    <i class="fas fa-desktop me-2"></i> Kiosk
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="allowManualMeeting" checked>
                                                <label class="form-check-label" for="allowManualMeeting">
                                                    <i class="fas fa-user-check me-2"></i> Manual
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Tab 2: Form Builder -->
                        <div class="tab-pane fade" id="form" role="tabpanel">
                            <div class="form-builder-container">
                                <div class="form-check mb-4">
                                    <input class="form-check-input" type="checkbox" id="requireForm">
                                    <label class="form-check-label" for="requireForm">
                                        <strong>Require attendees to fill this form</strong> (Meeting cannot be created without at least one field)
                                    </label>
                                </div>
                                
                                <h5 class="mb-4">Custom Attendance Form Builder</h5>
                                <p class="text-muted mb-4">Add custom fields that attendees will fill when joining the meeting.</p>
                                
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="mb-4">
                                            <h6>Form Fields</h6>
                                            <div id="formFieldsList">
                                                <div class="alert alert-info">
                                                    No fields added yet. Click "Add Field" to create your first form field.
                                                </div>
                                            </div>
                                            
                                            <div class="mt-4">
                                                <button class="btn btn-outline-custom" onclick="addFormField()">
                                                    <i class="fas fa-plus me-2"></i> Add Field
                                                </button>
                                                <button class="btn btn-outline-secondary" onclick="addDefaultFields()">
                                                    <i class="fas fa-magic me-2"></i> Add Default Fields
                                                </button>
                                                <button class="btn btn-outline-secondary" onclick="clearFormFields()">
                                                    <i class="fas fa-trash me-2"></i> Clear All
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4">
                                        <div class="preview-form">
                                            <h6>Form Preview</h6>
                                            <div id="formPreview">
                                                <p class="text-muted small">Form preview will appear here</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tab 3: Sharing & QR Code -->
                        <div class="tab-pane fade" id="sharing" role="tabpanel">
                            <div class="share-section">
                                <h5 class="mb-4">Share Meeting</h5>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="share-link-container">
                                            <h6><i class="fas fa-link me-2"></i> Meeting Link</h6>
                                            <p class="text-muted small mb-3">Share this link with attendees to join the meeting:</p>
                                            <div class="share-link" id="generatedLink">
                                                <span class="text-muted">Link will be generated after meeting creation</span>
                                            </div>
                                            <div class="mt-3 d-flex gap-2">
                                                <button class="btn btn-sm btn-primary-custom" onclick="copyMeetingLink()" id="copyLinkBtn" disabled>
                                                    <i class="fas fa-copy me-1"></i> Copy Link
                                                </button>
                                                <button class="btn btn-sm btn-outline-custom" onclick="testMeetingLink()" id="testLinkBtn" disabled>
                                                    <i class="fas fa-external-link-alt me-1"></i> Test Link
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6 mb-4">
                                        <div class="qr-code-container">
                                            <h6><i class="fas fa-qrcode me-2"></i> QR Code</h6>
                                            <p class="text-muted small mb-3">Scan this code to join the meeting:</p>
                                            <div id="qrCodeCanvas"></div>
                                            <div class="mt-3">
                                                <button class="btn btn-sm btn-primary-custom" onclick="downloadQRCode()" id="downloadQRBtn" disabled>
                                                    <i class="fas fa-download me-1"></i> Download QR Code
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <h6><i class="fas fa-share-alt me-2"></i> Share via</h6>
                                    <div class="d-flex gap-2 mt-3">
                                        <button class="btn btn-sm btn-outline-primary" onclick="shareViaEmail()" id="shareEmailBtn" disabled>
                                            <i class="fas fa-envelope me-1"></i> Email
                                        </button>
                                        <button class="btn btn-sm btn-outline-info" onclick="shareViaWhatsApp()" id="shareWhatsAppBtn" disabled>
                                            <i class="fab fa-whatsapp me-1"></i> WhatsApp
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="shareViaSMS()" id="shareSMSBtn" disabled>
                                            <i class="fas fa-sms me-1"></i> SMS
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tab 4: Advanced Settings -->
                        <div class="tab-pane fade" id="advanced" role="tabpanel">
                            <div class="form-builder-container">
                                <h5 class="mb-4">Advanced Meeting Settings</h5>
                                
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Verification Strictness</label>
                                            <select class="form-select" id="meetingVerificationStrictness">
                                                <option value="low">Low - Relaxed verification</option>
                                                <option value="medium" selected>Medium - Balanced verification</option>
                                                <option value="high">High - Strict verification</option>
                                            </select>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Time Verification</label>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="requireMinimumStay">
                                                <label class="form-check-label" for="requireMinimumStay">
                                                    Require minimum stay time
                                                </label>
                                            </div>
                                            <div class="input-group mb-3" id="minimumStayContainer" style="display: none;">
                                                <input type="number" class="form-control" id="minimumStayMinutes" value="5" min="1" max="120">
                                                <span class="input-group-text">minutes</span>
                                            </div>
                                            
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="enableContinuousMonitoring">
                                                <label class="form-check-label" for="enableContinuousMonitoring">
                                                    Enable continuous monitoring
                                                </label>
                                            </div>
                                            
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="autoVerifyAfterStay">
                                                <label class="form-check-label" for="autoVerifyAfterStay">
                                                    Auto-verify after minimum stay
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Duplicate Prevention</label>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="preventSameDeviceMeeting" checked>
                                                <label class="form-check-label" for="preventSameDeviceMeeting">
                                                    Prevent same device
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="preventSamePhoneMeeting" checked>
                                                <label class="form-check-label" for="preventSamePhoneMeeting">
                                                    Prevent same phone
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="preventSameNameTimeMeeting" checked>
                                                <label class="form-check-label" for="preventSameNameTimeMeeting">
                                                    Prevent same name
                                                </label>
                                            </div>
                                            <div class="input-group mb-3">
                                                <input type="number" class="form-control" id="duplicateWindowMinutes" value="5" min="1" max="60">
                                                <span class="input-group-text">minutes window</span>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">PWA Settings</label>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="enableMeetingPWA" checked>
                                                <label class="form-check-label" for="enableMeetingPWA">
                                                    Enable PWA for this meeting
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="enablePushNotifications">
                                                <label class="form-check-label" for="enablePushNotifications">
                                                    Enable push notifications
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    These settings will override the organization defaults for this specific meeting.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <div>
                            <button class="btn btn-outline-secondary" onclick="prevTab()">
                                <i class="fas fa-arrow-left me-2"></i> Previous
                            </button>
                            <button class="btn btn-outline-secondary ms-2" onclick="nextTab()">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary-custom" onclick="createMeeting()">Create Meeting</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Meeting Details Modal -->
    <div class="modal fade" id="meetingDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content modal-custom">
                <div class="modal-header modal-header-custom">
                    <h5 class="modal-title">Meeting Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="meetingDetailsContent">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Admin Modal -->
    <div class="modal fade" id="createAdminModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-custom">
                <div class="modal-header modal-header-custom">
                    <h5 class="modal-title">Add New Admin</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createAdminForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="adminFullName" required>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="adminEmail" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="adminPhone">
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Password</label>
                                <input type="password" class="form-control" id="adminPassword" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Role</label>
                                <select class="form-select" id="adminRole" required>
                                    <option value="admin">Admin</option>
                                    <option value="viewer">Viewer</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="adminStatus" required>
                                    <option value="active" selected>Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label fw-bold">Permissions</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="adminCanCreateMeetings" checked>
                                        <label class="form-check-label" for="adminCanCreateMeetings">
                                            Can create meetings
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="adminCanEditMeetings" checked>
                                        <label class="form-check-label" for="adminCanEditMeetings">
                                            Can edit meetings
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="adminCanViewReports" checked>
                                        <label class="form-check-label" for="adminCanViewReports">
                                            Can view reports
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="adminCanDeleteMeetings">
                                        <label class="form-check-label" for="adminCanDeleteMeetings">
                                            Can delete meetings
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="adminCanManageAdmins">
                                        <label class="form-check-label" for="adminCanManageAdmins">
                                            Can manage admins
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="adminCanApproveAttendance" checked>
                                        <label class="form-check-label" for="adminCanApproveAttendance">
                                            Can approve attendance
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary-custom">Add Admin</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content modal-custom">
            <div class="modal-header modal-header-custom">
                <h5 class="modal-title">Meeting Created Successfully! </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                    <h4>Your meeting is now active!</h4>
                    <p class="text-muted" id="successMeetingTitle"></p>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="share-link-container">
                            <h6><i class="fas fa-link me-2"></i> Meeting Link</h6>
                            <p class="text-muted small mb-3">Share this link with attendees:</p>
                            <div class="share-link" id="successMeetingLink">
                                <span class="text-muted">Loading...</span>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-sm btn-primary-custom w-100" onclick="copySuccessLink()">
                                    <i class="fas fa-copy me-1"></i> Copy Link
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="qr-code-container">
                            <h6><i class="fas fa-qrcode me-2"></i> QR Code</h6>
                            <p class="text-muted small mb-3">Scan to join meeting:</p>
                            <div id="successQRCode"></div>
                            <div class="mt-3">
                                <button class="btn btn-sm btn-primary-custom w-100" onclick="downloadSuccessQRCode()">
                                    <i class="fas fa-download me-1"></i> Download QR Code
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6><i class="fas fa-share-alt me-2"></i> Share via</h6>
                    <div class="d-flex gap-2 mt-3 flex-wrap">
                        <button class="btn btn-sm btn-outline-primary" onclick="shareSuccessViaEmail()">
                            <i class="fas fa-envelope me-1"></i> Email
                        </button>
                        <button class="btn btn-sm btn-outline-success" onclick="shareSuccessViaWhatsApp()">
                            <i class="fab fa-whatsapp me-1"></i> WhatsApp
                        </button>
                        <button class="btn btn-sm btn-outline-info" onclick="shareSuccessViaSMS()">
                            <i class="fas fa-sms me-1"></i> SMS
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="shareSuccessViaCopy()">
                            <i class="fas fa-copy me-1"></i> Copy All
                        </button>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6><i class="fas fa-key me-2"></i> Access Codes</h6>
                    <div class="row mt-2">
                        <div class="col-md-4">
                            <div class="bg-light p-2 rounded text-center">
                                <small class="text-muted d-block">SMS Code</small>
                                <code class="fw-bold" id="successSmsCode">----</code>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light p-2 rounded text-center">
                                <small class="text-muted d-block">USSD Code</small>
                                <code class="fw-bold" id="successUssdCode">----</code>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-light p-2 rounded text-center">
                                <small class="text-muted d-block">Public Code</small>
                                <code class="fw-bold" id="successPublicCode">----</code>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Next Steps:</strong> Share the link/QR code with attendees. Monitor attendance in real-time from your dashboard.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary-custom" onclick="goToMeetingDashboard()">
                    <i class="fas fa-chart-bar me-2"></i> Go to Dashboard
                </button>
            </div>
        </div>
    </div>
</div>
    
    <!-- Location Test Modal -->
    <div class="modal fade" id="locationTestModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-custom">
                <div class="modal-header modal-header-custom">
                    <h5 class="modal-title">Test Location Verification</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="locationTestModalContent">
                        <!-- Content will be filled dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Real-time Monitoring Modal -->
    <div class="modal fade" id="realTimeMonitoringModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content modal-custom">
                <div class="modal-header modal-header-custom">
                    <h5 class="modal-title">Real-time Monitoring</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="monitoring-panel">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <h3 id="monitoringActiveAttendees">0</h3>
                                <small>Active Attendees</small>
                            </div>
                            <div class="col-md-3">
                                <h3 id="monitoringTotalAttendees">0</h3>
                                <small>Total Attendees</small>
                            </div>
                            <div class="col-md-3">
                                <h3 id="monitoringVerified">0</h3>
                                <small>Verified</small>
                            </div>
                            <div class="col-md-3">
                                <h3 id="monitoringPending">0</h3>
                                <small>Pending</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container mt-4">
                        <div class="table-header">
                            <h5 class="mb-0">Live Attendance Feed</h5>
                            <span class="badge bg-danger live-badge">LIVE</span>
                        </div>
                        <div class="p-3">
                            <div class="live-feed-container" id="modalLiveFeed">
                                <!-- Live feed will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- AOS Animation Library -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- Main JavaScript -->
    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true
        });
        
        // Global variables
        let currentUser = null;
        let authToken = null;
        let currentOrganization = null;
        let attendanceChart = null;
        let trendChart = null;
        let methodChart = null;
        let currentMeetingFormFields = [];
        let generatedMeetingLink = '';
        let generatedQRCode = '';
        let currentMeetingCode = '';
        let liveFeedInterval = null;
        let deferredPrompt = null;
        let serviceWorkerRegistration = null;
        
        // API Base URL
        const API_BASE_URL = 'https://gsb-hrs3.onrender.com/api';
        const FRONTEND_URL = 'https://gsf-inky.vercel.app';
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading spinner
            setTimeout(() => {
                document.getElementById('loadingSpinner').style.display = 'none';
            }, 1000);
            
            // Check if user is already logged in
            checkAuthStatus();
            
            // Setup form submissions
            setupForms();
            
            // Setup navbar scroll effect
            setupNavbarScroll();
            
            // Setup sidebar toggle
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);
            
            // Initialize form builder
            initializeFormBuilder();
            
            // Close sidebar when clicking overlay
            document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                const toggleBtn = document.getElementById('toggleSidebar');
                
                if (window.innerWidth <= 992) {
                    if (!sidebar.contains(event.target) && !toggleBtn.contains(event.target) && 
                        sidebar.classList.contains('active')) {
                        closeSidebar();
                    }
                }
            });
            
            // PWA Installation
            setupPWA();
            
            // Setup real-time updates
            setupRealTimeUpdates();
            
            // Check for updates
            checkForUpdates();
        });
        
        // Setup PWA
        function setupPWA() {
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js').then(reg => {
                    serviceWorkerRegistration = reg;
                    console.log('Service Worker registered');
                    
                    // Check for updates
                    reg.addEventListener('updatefound', () => {
                        const newWorker = reg.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showToast('New version available! Refresh to update.', 'info');
                            }
                        });
                    });
                }).catch(err => {
                    console.log('Service Worker registration failed:', err);
                });
                
                // Listen for beforeinstallprompt event
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    
                    // Show install button
                    document.getElementById('pwaInstallBtn').style.display = 'block';
                    document.getElementById('pwaBanner').classList.add('show');
                    
                    // Update PWA status
                    updatePwaStatus();
                });
                
                // Check if app is already installed
                window.addEventListener('appinstalled', () => {
                    console.log('PWA installed');
                    deferredPrompt = null;
                    document.getElementById('pwaInstallBtn').style.display = 'none';
                    document.getElementById('pwaBanner').classList.remove('show');
                    updatePwaStatus();
                });
            }
            
            // Check if app is running in standalone mode
            if (window.matchMedia('(display-mode: standalone)').matches || 
                window.navigator.standalone === true) {
                console.log('Running in standalone mode');
                updatePwaStatus();
            }
        }
        
        // Update PWA status display
        function updatePwaStatus() {
            const statusElement = document.getElementById('pwaInstallStatus');
            const installButton = document.getElementById('installPwaBtn');
            
            if (window.matchMedia('(display-mode: standalone)').matches) {
                statusElement.innerHTML = '<span class="badge bg-success">Installed</span>';
                installButton.disabled = true;
                installButton.innerHTML = '<i class="fas fa-check me-2"></i> Installed';
            } else if (deferredPrompt) {
                statusElement.innerHTML = '<span class="badge bg-warning">Install Available</span>';
                installButton.disabled = false;
                installButton.innerHTML = '<i class="fas fa-download me-2"></i> Install PWA';
            } else {
                statusElement.innerHTML = '<span class="badge bg-secondary">Not Installable</span>';
                installButton.disabled = true;
                installButton.innerHTML = '<i class="fas fa-download me-2"></i> Install PWA';
            }
        }
        
        // Install PWA
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        showToast('App installed successfully!', 'success');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }
        
        // Dismiss PWA banner
        function dismissPwaBanner() {
            document.getElementById('pwaBanner').classList.remove('show');
            // Store dismissal in localStorage
            localStorage.setItem('pwaBannerDismissed', 'true');
        }
        
        // Check authentication status
        function checkAuthStatus() {
            const token = localStorage.getItem('gsams_token');
            const user = localStorage.getItem('gsams_user');
            
            if (token && user) {
                authToken = token;
                currentUser = JSON.parse(user);
                showPage('dashboard');
                loadDashboardData();
            } else {
                showPage('home');
            }
        }
        
        // Setup form submissions
        function setupForms() {
            // Register form
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                registerUser();
            });
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                loginUser();
            });
            
            // Create admin form
            document.getElementById('createAdminForm').addEventListener('submit', function(e) {
                e.preventDefault();
                createAdmin();
            });
            
            // Settings form
            document.getElementById('settingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSettings();
            });
            
            // Advanced meeting settings
            document.getElementById('requireMinimumStay').addEventListener('change', function() {
                document.getElementById('minimumStayContainer').style.display = 
                    this.checked ? 'flex' : 'none';
            });
        }
        
        // Setup navbar scroll effect
        function setupNavbarScroll() {
            window.addEventListener('scroll', function() {
                const navbar = document.querySelector('.navbar');
                if (window.scrollY > 50) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            });
        }
        
        // Setup real-time updates
        function setupRealTimeUpdates() {
            // Start live feed if user is logged in
            if (authToken) {
                startLiveFeed();
            }
        }
        
        // Start live feed
        function startLiveFeed() {
            if (liveFeedInterval) {
                clearInterval(liveFeedInterval);
            }
            
            // Update live feed every 10 seconds
            liveFeedInterval = setInterval(() => {
                if (document.getElementById('dashboard-home').style.display !== 'none') {
                    updateLiveFeed();
                }
            }, 10000);
            
            // Initial update
            updateLiveFeed();
        }
        
        // Update live feed
        async function updateLiveFeed() {
            try {
                const response = await fetch(`${API_BASE_URL}/dashboard/stats`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Update live stats
                    document.getElementById('liveAttendees').textContent = data.summary.todayAttendance || 0;
                    document.getElementById('liveMeetings').textContent = data.summary.activeMeetings || 0;
                    document.getElementById('liveVerified').textContent = data.summary.totalAttendance || 0;
                    
                    // Update live feed
                    updateLiveFeedDisplay(data.recentAttendance);
                }
            } catch (error) {
                console.error('Live feed update error:', error);
            }
        }
        
        // Update live feed display
        function updateLiveFeedDisplay(attendance) {
            const feedContainer = document.getElementById('liveFeed');
            if (!attendance || attendance.length === 0) {
                feedContainer.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-muted">No recent attendance</p>
                    </div>
                `;
                return;
            }
            
            let feedHTML = '';
            attendance.slice(0, 5).forEach(record => {
                const time = new Date(record.createdAt);
                const timeStr = time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Get method icon
                let methodIcon = 'fa-map-marker-alt';
                let methodClass = 'gps';
                switch(record.verificationType) {
                    case 'sms': methodIcon = 'fa-sms'; methodClass = 'sms'; break;
                    case 'ussd': methodIcon = 'fa-mobile-alt'; methodClass = 'ussd'; break;
                    case 'kiosk': methodIcon = 'fa-desktop'; methodClass = 'kiosk'; break;
                    case 'manual': methodIcon = 'fa-user-check'; methodClass = 'manual'; break;
                }
                
                feedHTML += `
                    <div class="live-feed-item attendance-card ${methodClass}">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas ${methodIcon} me-2"></i>
                                <strong>${record.attendeeInfo.fullName}</strong>
                            </div>
                            <div>
                                <span class="badge bg-${record.status === 'verified' ? 'success' : 'warning'}">
                                    ${record.status}
                                </span>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <small class="text-muted">
                                ${record.meetingId?.title || 'Meeting'}
                            </small>
                            <small class="text-muted">${timeStr}</small>
                        </div>
                    </div>
                `;
            });
            
            feedContainer.innerHTML = feedHTML;
            
            // Add animation to new items
            const items = feedContainer.querySelectorAll('.live-feed-item');
            items.forEach(item => {
                item.classList.add('new');
                setTimeout(() => item.classList.remove('new'), 2000);
            });
        }
        
        // Show/hide pages
        function showPage(page) {
            // Hide all pages
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            
            // Show selected page
            if (page === 'home') {
                document.getElementById('homePage').style.display = 'block';
                window.scrollTo(0, 0);
            } else if (page === 'register') {
                document.getElementById('registerPage').style.display = 'flex';
            } else if (page === 'login') {
                document.getElementById('loginPage').style.display = 'flex';
            } else if (page === 'dashboard') {
                document.getElementById('dashboard').style.display = 'block';
                loadDashboardData();
                startLiveFeed();
            }
        }
        
        // Show/hide dashboard sections
        function showDashboardSection(section) {
            // Close sidebar on mobile
            closeSidebar();
            
            // Hide all sections
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach(sec => {
                sec.style.display = 'none';
            });
            
            // Update active menu item
            const menuItems = document.querySelectorAll('.sidebar-item');
            menuItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Mark clicked item as active
            event.target.classList.add('active');
            
            // Show selected section
            document.getElementById(section).style.display = 'block';
            
            // Update page title
            const titles = {
                'dashboard-home': 'Dashboard',
                'meetings': 'Meetings',
                'attendance': 'Attendance',
                'reports': 'Reports',
                'admins': 'Admins',
                'settings': 'Settings',
                'audit-logs': 'Audit Logs',
                'location-test': 'Location Test',
                'pwa-settings': 'PWA Settings'
            };
            
            document.getElementById('pageTitle').textContent = titles[section] || 'Dashboard';
            
            // Load section data
            if (section === 'meetings') {
                loadMeetings();
            } else if (section === 'attendance') {
                loadAttendance();
            } else if (section === 'reports') {
                loadAnalytics('week');
            } else if (section === 'admins') {
                loadAdmins();
            } else if (section === 'audit-logs') {
                loadAuditLogs();
            } else if (section === 'settings') {
                loadSettings();
            } else if (section === 'location-test') {
                loadLocationTestData();
            } else if (section === 'pwa-settings') {
                loadPwaSettings();
            }
        }
        
        // Toggle sidebar on mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // Prevent body scroll when sidebar is open
            if (sidebar.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = 'auto';
            }
        }
        
        // Close sidebar on mobile
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        // Initialize form builder
        function initializeFormBuilder() {
            currentMeetingFormFields = [];
            updateFormPreview();
        }
        
        // Add form field
        function addFormField(type = 'text', label = '', placeholder = '', required = false, options = []) {
            const fieldId = 'field_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            const field = {
                id: fieldId,
                type: type || 'text',
                label: label || 'New Field',
                placeholder: placeholder || 'Enter value',
                required: required || false,
                options: options || []
            };
            
            currentMeetingFormFields.push(field);
            renderFormField(field);
            updateFormPreview();
        }
        
        // Add default fields
        function addDefaultFields() {
            // Clear existing fields
            currentMeetingFormFields = [];
            document.getElementById('formFieldsList').innerHTML = '';
            
            // Add default fields
            addFormField('text', 'Full Name', 'Enter your full name', true);
            addFormField('email', 'Email Address', 'Enter your email address', false);
            addFormField('tel', 'Phone Number', 'Enter your phone number', true);
            addFormField('text', 'Employee/Student ID', 'Enter your ID number', false);
            addFormField('select', 'Department', 'Select your department', false, ['IT', 'HR', 'Finance', 'Operations', 'Marketing']);
            addFormField('textarea', 'Comments', 'Any additional comments', false);
            
            showToast('Default fields added successfully', 'success');
        }
        
        // Clear all form fields
        function clearFormFields() {
            if (confirm('Are you sure you want to clear all form fields?')) {
                currentMeetingFormFields = [];
                document.getElementById('formFieldsList').innerHTML = 
                    '<div class="alert alert-info">No fields added yet. Click "Add Field" to create your first form field.</div>';
                updateFormPreview();
                showToast('All fields cleared', 'success');
            }
        }
        
        // Render form field in builder
        function renderFormField(field) {
            const fieldsList = document.getElementById('formFieldsList');
            
            // Remove the "no fields" message if it exists
            const alert = fieldsList.querySelector('.alert');
            if (alert) {
                alert.remove();
            }
            
            const fieldElement = document.createElement('div');
            fieldElement.className = 'form-field-item';
            fieldElement.id = 'fieldItem_' + field.id;
            
            let optionsHTML = '';
            if (field.type === 'select' || field.type === 'radio' || field.type === 'checkbox') {
                optionsHTML = `
                    <div class="mt-2">
                        <small class="text-muted">Options (one per line):</small>
                        <textarea class="form-control form-control-sm" rows="2" onchange="updateFieldOptions('${field.id}', this.value)">${field.options.join('\n')}</textarea>
                    </div>
                `;
            }
            
            fieldElement.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="mb-1">${field.label} <span class="badge bg-secondary">${field.type}</span></h6>
                        <small class="text-muted">${field.placeholder}</small>
                        ${field.required ? '<span class="badge bg-danger ms-2">Required</span>' : ''}
                    </div>
                    <div class="field-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="editField('${field.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="removeField('${field.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                ${optionsHTML}
            `;
            
            fieldsList.appendChild(fieldElement);
        }
        
        // Update field options
        function updateFieldOptions(fieldId, optionsText) {
            const field = currentMeetingFormFields.find(f => f.id === fieldId);
            if (field) {
                field.options = optionsText.split('\n').filter(opt => opt.trim() !== '');
                updateFormPreview();
            }
        }
        
        // Edit field
        function editField(fieldId) {
            const field = currentMeetingFormFields.find(f => f.id === fieldId);
            if (!field) return;
            
            const newLabel = prompt('Enter field label:', field.label);
            if (newLabel === null) return;
            
            const newPlaceholder = prompt('Enter field placeholder:', field.placeholder);
            if (newPlaceholder === null) return;
            
            const isRequired = confirm('Is this field required?');
            
            field.label = newLabel;
            field.placeholder = newPlaceholder;
            field.required = isRequired;
            
            // Update the field element
            const fieldElement = document.getElementById('fieldItem_' + fieldId);
            if (fieldElement) {
                fieldElement.querySelector('h6').innerHTML = `${field.label} <span class="badge bg-secondary">${field.type}</span>`;
                fieldElement.querySelector('small').textContent = field.placeholder;
                
                const requiredBadge = fieldElement.querySelector('.badge.bg-danger');
                if (field.required && !requiredBadge) {
                    fieldElement.querySelector('h6').innerHTML += ' <span class="badge bg-danger">Required</span>';
                } else if (!field.required && requiredBadge) {
                    requiredBadge.remove();
                }
            }
            
            updateFormPreview();
            showToast('Field updated successfully', 'success');
        }
        
        // Remove field
        function removeField(fieldId) {
            if (!confirm('Are you sure you want to remove this field?')) return;
            
            currentMeetingFormFields = currentMeetingFormFields.filter(f => f.id !== fieldId);
            const fieldElement = document.getElementById('fieldItem_' + fieldId);
            if (fieldElement) {
                fieldElement.remove();
            }
            
            // Show "no fields" message if list is empty
            if (currentMeetingFormFields.length === 0) {
                const fieldsList = document.getElementById('formFieldsList');
                fieldsList.innerHTML = '<div class="alert alert-info">No fields added yet. Click "Add Field" to create your first form field.</div>';
            }
            
            updateFormPreview();
            showToast('Field removed successfully', 'success');
        }
        
        // Update form preview
        function updateFormPreview() {
            const preview = document.getElementById('formPreview');
            
            if (currentMeetingFormFields.length === 0) {
                preview.innerHTML = '<p class="text-muted small">No fields added yet</p>';
                return;
            }
            
            let previewHTML = '<form id="previewForm">';
            
            currentMeetingFormFields.forEach((field, index) => {
                let fieldHTML = '';
                
                switch(field.type) {
                    case 'text':
                    case 'email':
                    case 'tel':
                    case 'number':
                        fieldHTML = `
                            <div class="mb-3">
                                <label class="form-label">${field.label} ${field.required ? '<span class="text-danger">*</span>' : ''}</label>
                                <input type="${field.type}" class="form-control" placeholder="${field.placeholder}" ${field.required ? 'required' : ''}>
                            </div>
                        `;
                        break;
                        
                    case 'textarea':
                        fieldHTML = `
                            <div class="mb-3">
                                <label class="form-label">${field.label} ${field.required ? '<span class="text-danger">*</span>' : ''}</label>
                                <textarea class="form-control" rows="3" placeholder="${field.placeholder}" ${field.required ? 'required' : ''}></textarea>
                            </div>
                        `;
                        break;
                        
                    case 'select':
                        let optionsHTML = '<option value="">Select...</option>';
                        field.options.forEach(option => {
                            optionsHTML += `<option value="${option}">${option}</option>`;
                        });
                        
                        fieldHTML = `
                            <div class="mb-3">
                                <label class="form-label">${field.label} ${field.required ? '<span class="text-danger">*</span>' : ''}</label>
                                <select class="form-select" ${field.required ? 'required' : ''}>
                                    ${optionsHTML}
                                </select>
                            </div>
                        `;
                        break;
                        
                    case 'radio':
                        fieldHTML = `
                            <div class="mb-3">
                                <label class="form-label">${field.label} ${field.required ? '<span class="text-danger">*</span>' : ''}</label>
                                ${field.options.map(option => `
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="${field.id}" id="${field.id}_${option}" value="${option}">
                                        <label class="form-check-label" for="${field.id}_${option}">${option}</label>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        break;
                        
                    case 'checkbox':
                        fieldHTML = `
                            <div class="mb-3">
                                <label class="form-label">${field.label} ${field.required ? '<span class="text-danger">*</span>' : ''}</label>
                                ${field.options.map(option => `
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="${field.id}_${option}" value="${option}">
                                        <label class="form-check-label" for="${field.id}_${option}">${option}</label>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        break;
                }
                
                previewHTML += fieldHTML;
            });
            
            previewHTML += '<button type="submit" class="btn btn-primary-custom w-100">Submit Attendance</button></form>';
            preview.innerHTML = previewHTML;
        }
        
        // Validate meeting creation form
        function validateMeetingCreation() {
            // Validate basic meeting details
            if (!validateMeetingDetails()) {
                showToast('Please fill in all required meeting details', 'error');
                return false;
            }
            
            // Validate form builder (at least one field if form is required)
            const meetingFormRequired = document.getElementById('requireForm')?.checked || false;
            if (meetingFormRequired && currentMeetingFormFields.length === 0) {
                showToast('Form is required but no fields added. Please add at least one field.', 'error');
                // Switch to form tab
                document.querySelector('#form-tab').click();
                return false;
            }
            
            return true;
        }
        
        // Tab navigation for create meeting modal
        function nextTab() {
            const currentTab = document.querySelector('#meetingTabs .nav-link.active');
            const tabs = Array.from(document.querySelectorAll('#meetingTabs .nav-link'));
            const currentIndex = tabs.indexOf(currentTab);
            
            if (currentIndex < tabs.length - 1) {
                const nextTab = tabs[currentIndex + 1];
                const nextTabPane = document.querySelector(nextTab.getAttribute('data-bs-target'));
                
                // Validate current tab before proceeding
                if (currentIndex === 0) { // Details tab
                    if (!validateMeetingDetails()) {
                        showToast('Please fill in all required meeting details', 'error');
                        return;
                    }
                } else if (currentIndex === 1) { // Form builder tab
                    const requireForm = document.getElementById('requireForm')?.checked || false;
                    if (requireForm && currentMeetingFormFields.length === 0) {
                        showToast('Form is required but no fields added. Please add at least one field.', 'error');
                        return;
                    }
                }
                
                // Show next tab
                currentTab.classList.remove('active');
                currentTab.setAttribute('aria-selected', 'false');
                
                nextTab.classList.add('active');
                nextTab.setAttribute('aria-selected', 'true');
                
                // Show next tab content
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.remove('show', 'active');
                });
                nextTabPane.classList.add('show', 'active');
            }
        }
        
        function prevTab() {
            const currentTab = document.querySelector('#meetingTabs .nav-link.active');
            const tabs = Array.from(document.querySelectorAll('#meetingTabs .nav-link'));
            const currentIndex = tabs.indexOf(currentTab);
            
            if (currentIndex > 0) {
                const prevTab = tabs[currentIndex - 1];
                const prevTabPane = document.querySelector(prevTab.getAttribute('data-bs-target'));
                
                // Show previous tab
                currentTab.classList.remove('active');
                currentTab.setAttribute('aria-selected', 'false');
                
                prevTab.classList.add('active');
                prevTab.setAttribute('aria-selected', 'true');
                
                // Show previous tab content
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.remove('show', 'active');
                });
                prevTabPane.classList.add('show', 'active');
            }
        }
        
        // Validate meeting details
        function validateMeetingDetails() {
            const title = document.getElementById('meetingTitle').value.trim();
            const locationName = document.getElementById('meetingLocationName').value.trim();
            const startTime = document.getElementById('meetingStartTime').value;
            const endTime = document.getElementById('meetingEndTime').value;
            const latitude = document.getElementById('meetingLatitude').value;
            const longitude = document.getElementById('meetingLongitude').value;
            
            if (!title) {
                showToast('Meeting title is required', 'error');
                return false;
            }
            
            if (!locationName) {
                showToast('Location name is required', 'error');
                return false;
            }
            
            if (!startTime) {
                showToast('Start time is required', 'error');
                return false;
            }
            
            if (!endTime) {
                showToast('End time is required', 'error');
                return false;
            }
            
            if (!latitude || !longitude) {
                showToast('Location coordinates are required', 'error');
                return false;
            }
            
            return true;
        }
        
        // Register user
        async function registerUser() {
            const organizationName = document.getElementById('regOrganizationName').value;
            const fullName = document.getElementById('regFullName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            // Show loading
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        password,
                        fullName,
                        phone,
                        organizationName
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Save token and user data
                    authToken = data.token;
                    currentUser = data.user;
                    
                    localStorage.setItem('gsams_token', authToken);
                    localStorage.setItem('gsams_user', JSON.stringify(currentUser));
                    
                    showToast('Registration successful!', 'success');
                    showPage('dashboard');
                } else {
                    showToast(data.error || 'Registration failed', 'error');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showToast('Registration failed. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Login user
        async function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Show loading
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        password
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Save token and user data
                    authToken = data.token;
                    currentUser = data.user;
                    
                    localStorage.setItem('gsams_token', authToken);
                    localStorage.setItem('gsams_user', JSON.stringify(currentUser));
                    
                    showToast('Login successful!', 'success');
                    showPage('dashboard');
                } else {
                    showToast(data.error || 'Login failed', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login failed. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Logout
        function logout() {
            localStorage.removeItem('gsams_token');
            localStorage.removeItem('gsams_user');
            authToken = null;
            currentUser = null;
            
            // Clear intervals
            if (liveFeedInterval) {
                clearInterval(liveFeedInterval);
                liveFeedInterval = null;
            }
            
            showToast('Logged out successfully', 'success');
            showPage('home');
        }
        
        // Load dashboard data
        async function loadDashboardData() {
            if (!authToken) return;
            
            try {
                // Load dashboard stats
                const response = await fetch(`${API_BASE_URL}/dashboard/stats`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Update stats
                    document.getElementById('totalMeetings').textContent = data.summary.totalMeetings;
                    document.getElementById('activeMeetings').textContent = data.summary.activeMeetings;
                    document.getElementById('totalAttendance').textContent = data.summary.totalAttendance;
                    document.getElementById('todayAttendance').textContent = data.summary.todayAttendance;
                    
                    // Update user info
                    document.getElementById('userName').textContent = currentUser.fullName;
                    document.getElementById('userRole').textContent = currentUser.role === 'super_admin' ? 'Super Admin' : 
                                                                     currentUser.role === 'admin' ? 'Admin' : 'Viewer';
                    document.getElementById('userAvatar').textContent = getInitials(currentUser.fullName);
                    
                    // Update recent attendance
                    updateRecentAttendance(data.recentAttendance);
                    
                    // Update attendance chart
                    updateAttendanceChart(data.byType);
                    
                    // Load upcoming meetings
                    loadUpcomingMeetings();
                    
                    // Load organization info
                    loadOrganizationInfo();
                }
            } catch (error) {
                console.error('Dashboard data error:', error);
            }
        }
        
        // Load organization info
        async function loadOrganizationInfo() {
            try {
                const response = await fetch(`${API_BASE_URL}/organization`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const org = await response.json();
                    currentOrganization = org;
                    
                    document.getElementById('orgName').textContent = org.name;
                    document.getElementById('orgDomain').textContent = org.domain;
                    document.getElementById('orgCreated').textContent = new Date(org.createdAt).toLocaleDateString();
                    document.getElementById('orgStatus').textContent = org.isActive ? 'Active' : 'Inactive';
                    
                    // Update API base URL display
                    document.getElementById('apiBaseUrl').textContent = API_BASE_URL;
                }
            } catch (error) {
                console.error('Organization info error:', error);
            }
        }
        
        // Load meetings
        // Update the loadMeetings function to include actions
async function loadMeetings() {
    try {
        const status = document.getElementById('meetingStatusFilter').value;
        const startDate = document.getElementById('meetingStartDate').value;
        const endDate = document.getElementById('meetingEndDate').value;
        const page = 1; // Add pagination if needed
        
        let url = `${API_BASE_URL}/organization/meetings/enhanced?page=${page}`;
        const params = new URLSearchParams();
        
        if (status) params.append('status', status);
        if (startDate) params.append('startDate', startDate);
        if (endDate) params.append('endDate', endDate);
        
        if (params.toString()) {
            url += `&${params.toString()}`;
        }
        
        const response = await fetch(url, {
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            updateMeetingsTable(data.meetings);
            
            // Store meetings for reference
            window.currentMeetings = data.meetings;
        }
    } catch (error) {
        console.error('Load meetings error:', error);
        showToast('Failed to load meetings', 'error');
    }
}

// Update meetings table with enhanced actions
function updateMeetingsTable(meetings) {
    const tbody = document.getElementById('meetingsTable');
    tbody.innerHTML = '';
    
    if (meetings.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="8" class="text-center py-5">
                    <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                    <h5>No meetings found</h5>
                    <p class="text-muted mb-4">Create your first meeting to get started</p>
                    <button class="btn btn-primary-custom" onclick="showCreateMeetingModal()">
                        <i class="fas fa-plus me-2"></i> Create Meeting
                    </button>
                </td>
            </tr>
        `;
        return;
    }
    
    meetings.forEach(meeting => {
        const row = document.createElement('tr');
        row.setAttribute('data-meeting-id', meeting._id);
        
        // Format date
        const startTime = new Date(meeting.schedule.startTime);
        const dateStr = startTime.toLocaleDateString() + ' ' + startTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        // Get attendance methods
        const methods = [];
        if (meeting.attendanceConfig?.allowedModes?.smartphoneGPS) methods.push('GPS');
        if (meeting.attendanceConfig?.allowedModes?.sms) methods.push('SMS');
        if (meeting.attendanceConfig?.allowedModes?.ussd) methods.push('USSD');
        if (meeting.attendanceConfig?.allowedModes?.kiosk) methods.push('Kiosk');
        if (meeting.attendanceConfig?.allowedModes?.manual) methods.push('Manual');
        
        // Status badge
        let statusBadge;
        switch(meeting.status) {
            case 'draft': statusBadge = '<span class="badge bg-secondary">Draft</span>'; break;
            case 'active': statusBadge = '<span class="badge bg-success">Active</span>'; break;
            case 'in_progress': statusBadge = '<span class="badge bg-primary">In Progress</span>'; break;
            case 'completed': statusBadge = '<span class="badge bg-info">Completed</span>'; break;
            case 'cancelled': statusBadge = '<span class="badge bg-danger">Cancelled</span>'; break;
            default: statusBadge = '<span class="badge bg-secondary">Unknown</span>';
        }
        
        // Validation status indicator
        let validationBadge = '';
        if (meeting.status === 'draft') {
            const completedSections = Object.values(meeting.validationStatus?.sections || {}).filter(v => v).length;
            const totalSections = Object.keys(meeting.validationStatus?.sections || {}).length;
            validationBadge = `
                <div class="progress" style="height: 5px; width: 60px;" title="${completedSections}/${totalSections} sections complete">
                    <div class="progress-bar bg-info" style="width: ${(completedSections/totalSections)*100}%"></div>
                </div>
            `;
        }
        
        row.innerHTML = `
            <td>
                <strong>${meeting.title}</strong>
                ${validationBadge}
            </td>
            <td>${dateStr}</td>
            <td>${meeting.location.name}</td>
            <td>
                <div class="d-flex flex-wrap gap-1">
                    ${methods.map(method => `<span class="badge bg-primary">${method}</span>`).join('')}
                </div>
            </td>
            <td>${statusBadge}</td>
            <td>${meeting.attendanceCount || 0}</td>
            <td>
                <div class="d-flex gap-1">
                    <button class="btn btn-sm btn-outline-primary" onclick="viewMeeting('${meeting._id}')" title="View Details">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-warning" onclick="editMeeting('${meeting._id}')" 
                            ${meeting.canBeEdited ? '' : 'disabled'} title="Edit Meeting">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteMeeting('${meeting._id}')" 
                            ${meeting.canBeDeleted ? '' : 'disabled'} title="Delete Meeting">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="activateMeeting('${meeting._id}')" 
                            ${meeting.status === 'draft' && meeting.validationStatus?.allSectionsComplete ? '' : 'disabled'} 
                            title="Activate Meeting">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
            </td>
        `;
        
        tbody.appendChild(row);
    });
}

// View meeting details
async function viewMeeting(meetingId) {
    try {
        const response = await fetch(`${API_BASE_URL}/meetings/${meetingId}/full`, {
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });
        
        if (response.ok) {
            const meeting = await response.json();
            showMeetingDetailsModal(meeting);
        }
    } catch (error) {
        console.error('View meeting error:', error);
        showToast('Failed to load meeting details', 'error');
    }
}

// Edit meeting
async function editMeeting(meetingId) {
    try {
        const response = await fetch(`${API_BASE_URL}/meetings/${meetingId}/full`, {
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });
        
        if (response.ok) {
            const meeting = await response.json();
            
            // Populate the create meeting modal with existing data
            populateEditMeetingModal(meeting);
            
            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('createMeetingModal'));
            modal.show();
        }
    } catch (error) {
        console.error('Edit meeting error:', error);
        showToast('Failed to load meeting for editing', 'error');
    }
}

// Activate meeting
async function activateMeeting(meetingId) {
    if (!confirm('Are you sure you want to activate this meeting? This will make it available for attendance.')) {
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/meetings/${meetingId}/activate`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });
        
        if (response.ok) {
            const result = await response.json();
            showToast('Meeting activated successfully!', 'success');
            
            // Show success modal with sharing options
            successMeetingData = {
                meetingId: result.meeting.id,
                title: result.meeting.title,
                ...result.modalData
            };
            showSuccessModal(successMeetingData);
            
            // Reload meetings
            loadMeetings();
        } else {
            const error = await response.json();
            showToast(error.error || 'Failed to activate meeting', 'error');
            
            // Show validation errors if any
            if (error.validationStatus) {
                showValidationErrors(error.validationStatus);
            }
        }
    } catch (error) {
        console.error('Activate meeting error:', error);
        showToast('Failed to activate meeting', 'error');
    }
}

// Show validation errors
function showValidationErrors(validationStatus) {
    let errorMessage = 'Please complete the following sections:\n';
    validationStatus.messages.forEach((msg, index) => {
        errorMessage += `${index + 1}. ${msg}\n`;
    });
    
    alert(errorMessage);
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // ... existing code ...
    
    // Setup create meeting validation
    setupCreateMeetingValidation();
    
    // Load meetings on dashboard load
    if (authToken) {
        loadMeetings();
    }
});
        // Load upcoming meetings for dashboard
        async function loadUpcomingMeetings() {
            try {
                const now = new Date();
                const future = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000); // 30 days from now
                
                const response = await fetch(`${API_BASE_URL}/meetings?startDate=${now.toISOString()}&endDate=${future.toISOString()}&status=active`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const meetings = await response.json();
                    updateUpcomingMeetingsTable(meetings);
                }
            } catch (error) {
                console.error('Load upcoming meetings error:', error);
            }
        }
        
        // Load attendance records
        async function loadAttendance() {
            try {
                const meetingId = document.getElementById('attendanceMeetingFilter').value;
                const type = document.getElementById('attendanceTypeFilter').value;
                const status = document.getElementById('attendanceStatusFilter').value;
                
                // First, load meetings for the filter dropdown
                const meetingsResponse = await fetch(`${API_BASE_URL}/meetings`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (meetingsResponse.ok) {
                    const meetings = await meetingsResponse.json();
                    updateMeetingFilter(meetings);
                    
                    // If a specific meeting is selected, load its attendance
                    if (meetingId) {
                        const attendanceResponse = await fetch(`${API_BASE_URL}/meetings/${meetingId}/attendance`, {
                            headers: {
                                'Authorization': `Bearer ${authToken}`
                            }
                        });
                        
                        if (attendanceResponse.ok) {
                            const data = await attendanceResponse.json();
                            let attendance = data.attendance;
                            
                            // Apply filters
                            if (type) {
                                attendance = attendance.filter(a => a.verificationType === type);
                            }
                            
                            if (status) {
                                attendance = attendance.filter(a => a.status === status);
                            }
                            
                            updateAttendanceTable(attendance);
                        }
                    } else {
                        // For now, show empty table or message
                        updateAttendanceTable([]);
                    }
                }
            } catch (error) {
                console.error('Load attendance error:', error);
                showToast('Failed to load attendance', 'error');
            }
        }
        
        // Load admins
        async function loadAdmins() {
            try {
                const response = await fetch(`${API_BASE_URL}/admins`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const admins = await response.json();
                    updateAdminsTable(admins);
                }
            } catch (error) {
                console.error('Load admins error:', error);
                showToast('Failed to load admins', 'error');
            }
        }
        
        // Load audit logs
        async function loadAuditLogs() {
            try {
                const startDate = document.getElementById('auditStartDate').value;
                const endDate = document.getElementById('auditEndDate').value;
                const action = document.getElementById('auditActionFilter').value;
                const userId = document.getElementById('auditUserFilter').value;
                
                let url = `${API_BASE_URL}/audit-logs`;
                const params = new URLSearchParams();
                
                if (startDate) params.append('startDate', startDate);
                if (endDate) params.append('endDate', endDate);
                if (action) params.append('action', action);
                if (userId) params.append('userId', userId);
                
                if (params.toString()) {
                    url += `?${params.toString()}`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    updateAuditLogsTable(data.logs);
                    
                    // Load users for filter
                    loadAuditUsers();
                }
            } catch (error) {
                console.error('Load audit logs error:', error);
                showToast('Failed to load audit logs', 'error');
            }
        }
        
        // Load audit users for filter
        async function loadAuditUsers() {
            try {
                const response = await fetch(`${API_BASE_URL}/admins`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const admins = await response.json();
                    const select = document.getElementById('auditUserFilter');
                    
                    // Clear existing options except the first one
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                    
                    admins.forEach(admin => {
                        const option = document.createElement('option');
                        option.value = admin._id;
                        option.textContent = admin.fullName;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Load audit users error:', error);
            }
        }
        
        // Load settings
        async function loadSettings() {
            if (!currentOrganization) return;
            
            document.getElementById('defaultRadius').value = currentOrganization.settings.defaultLocationRadius;
            document.getElementById('defaultTimeWindow').value = currentOrganization.settings.defaultTimeWindow;
            document.getElementById('allowGPS').checked = currentOrganization.settings.allowGPS;
            document.getElementById('allowSMS').checked = currentOrganization.settings.allowSMS;
            document.getElementById('allowUSSD').checked = currentOrganization.settings.allowUSSD;
            document.getElementById('allowKiosk').checked = currentOrganization.settings.allowKiosk;
            document.getElementById('allowManual').checked = currentOrganization.settings.allowManual;
            document.getElementById('verificationStrictness').value = currentOrganization.settings.verificationStrictness || 'medium';
            document.getElementById('preventSameDevice').checked = currentOrganization.settings.preventSameDevice !== false;
            document.getElementById('preventSamePhone').checked = currentOrganization.settings.preventSamePhone !== false;
            document.getElementById('preventSameNameTime').checked = currentOrganization.settings.preventSameNameTime !== false;
        }
        
        // Load location test data
        async function loadLocationTestData() {
            try {
                // Load meetings for dropdown
                const response = await fetch(`${API_BASE_URL}/meetings`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const meetings = await response.json();
                    const select = document.getElementById('testMeetingSelect');
                    
                    // Clear existing options except the first one
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                    
                    meetings.forEach(meeting => {
                        const option = document.createElement('option');
                        option.value = meeting._id;
                        option.textContent = `${meeting.title} (${meeting.accessCodes.publicCode})`;
                        select.appendChild(option);
                    });
                }
                
                // Load location test history
                loadLocationTestHistory();
                
            } catch (error) {
                console.error('Load location test data error:', error);
            }
        }
        
        // Load location test history
        async function loadLocationTestHistory() {
            // This would load from localStorage or API
            const history = JSON.parse(localStorage.getItem('locationTestHistory') || '[]');
            updateLocationTestHistory(history);
        }
        
        // Load PWA settings
        function loadPwaSettings() {
            const settings = JSON.parse(localStorage.getItem('pwaSettings') || '{}');
            
            document.getElementById('enablePWA').checked = settings.enablePWA !== false;
            document.getElementById('pwaAppName').value = settings.appName || 'GSAMS Attendance';
            document.getElementById('pwaThemeColor').value = settings.themeColor || '#2196F3';
            document.getElementById('pwaBackgroundColor').value = settings.backgroundColor || '#ffffff';
            document.getElementById('pwaPushNewAttendance').checked = settings.pushNewAttendance !== false;
            document.getElementById('pwaPushMeetingStart').checked = settings.pushMeetingStart || false;
            document.getElementById('pwaPushReminders').checked = settings.pushReminders || false;
            document.getElementById('enableOffline').checked = settings.enableOffline !== false;
            
            // Update preview
            document.getElementById('pwaPreviewName').textContent = settings.appName || 'GSAMS Attendance';
            
            // Update PWA status
            updatePwaStatus();
            
            // Load registered devices
            loadRegisteredDevices();
            
            // Update cache info
            updateCacheInfo();
        }
        
        // Load registered devices
        function loadRegisteredDevices() {
            const devices = JSON.parse(localStorage.getItem('registeredDevices') || '[]');
            const container = document.getElementById('registeredDevices');
            
            if (devices.length === 0) {
                container.innerHTML = '<p class="text-muted">No devices registered yet.</p>';
                return;
            }
            
            let html = '';
            devices.forEach(device => {
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                        <div>
                            <small class="text-muted">${device.userAgent?.substring(0, 30)}...</small>
                            <br>
                            <small>Registered: ${new Date(device.registeredAt).toLocaleDateString()}</small>
                        </div>
                        <button class="btn btn-sm btn-outline-danger" onclick="unregisterDevice('${device.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Update cache info
        async function updateCacheInfo() {
            if ('caches' in window) {
                try {
                    const cache = await caches.open('gsams-cache');
                    const keys = await cache.keys();
                    const totalSize = keys.length; // Simplified size calculation
                    
                    document.getElementById('cacheSize').textContent = `${totalSize * 50} KB`; // Approximate
                    document.getElementById('cacheProgress').style.width = `${Math.min(totalSize * 5, 100)}%`;
                } catch (error) {
                    console.error('Cache info error:', error);
                }
            }
        }
        
        // Load analytics
        async function loadAnalytics(period) {
            try {
                // This would call actual analytics API
                // For now, we'll use mock data
                const mockData = generateMockAnalytics(period);
                
                // Update trend chart
                updateTrendChart(mockData.trend);
                
                // Update method chart
                updateMethodChart(mockData.methods);
                
                // Load location analytics
                loadLocationAnalytics();
                
            } catch (error) {
                console.error('Load analytics error:', error);
                showToast('Failed to load analytics', 'error');
            }
        }
        
        // Load location analytics
        async function loadLocationAnalytics() {
            try {
                // This would call actual location analytics API
                // For now, we'll show a placeholder
                const container = document.getElementById('locationAnalytics');
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Location analytics would show GPS accuracy, distance distribution, and verification rates.
                        <br>
                        <small class="mt-2 d-block">Select a specific meeting to view detailed location analytics.</small>
                    </div>
                `;
            } catch (error) {
                console.error('Load location analytics error:', error);
            }
        }
        
        // Create meeting
        async function createMeeting() {
            try {
                // Validate complete meeting creation form
                if (!validateMeetingCreation()) {
                    return;
                }
                
                // Show loading
                showLoading();
                
                const meetingData = {
                    title: document.getElementById('meetingTitle').value,
                    description: document.getElementById('meetingDescription').value,
                    location: {
                        name: document.getElementById('meetingLocationName').value,
                        latitude: parseFloat(document.getElementById('meetingLatitude').value),
                        longitude: parseFloat(document.getElementById('meetingLongitude').value),
                        radius: parseInt(document.getElementById('meetingRadius').value),
                        address: document.getElementById('meetingAddress').value
                    },
                    schedule: {
                        startTime: document.getElementById('meetingStartTime').value,
                        endTime: document.getElementById('meetingEndTime').value
                    },
                    attendanceConfig: {
                        allowedModes: {
                            smartphoneGPS: document.getElementById('allowGPSMeeting').checked,
                            sms: document.getElementById('allowSMSMeeting').checked,
                            ussd: document.getElementById('allowUSSDMeeting').checked,
                            kiosk: document.getElementById('allowKioskMeeting').checked,
                            manual: document.getElementById('allowManualMeeting').checked
                        },
                        verificationStrictness: document.getElementById('meetingVerificationStrictness').value,
                        duplicatePrevention: {
                            preventSameDevice: document.getElementById('preventSameDeviceMeeting').checked,
                            preventSamePhone: document.getElementById('preventSamePhoneMeeting').checked,
                            preventSameNameTime: document.getElementById('preventSameNameTimeMeeting').checked,
                            timeWindowMinutes: parseInt(document.getElementById('duplicateWindowMinutes').value)
                        }
                    },
                    customFormFields: currentMeetingFormFields,
                    timeVerification: {
                        requireMinimumStay: document.getElementById('requireMinimumStay').checked,
                        minimumStayMinutes: parseInt(document.getElementById('minimumStayMinutes').value),
                        enableContinuousMonitoring: document.getElementById('enableContinuousMonitoring').checked,
                        autoVerifyAfterStay: document.getElementById('autoVerifyAfterStay').checked
                    },
                    pwaSettings: {
                        enablePWA: document.getElementById('enableMeetingPWA').checked,
                        enablePushNotifications: document.getElementById('enablePushNotifications').checked
                    }
                };
                
                const response = await fetch(`${API_BASE_URL}/meetings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(meetingData)
                });
                
                if (response.ok) {
                    const meeting = await response.json();
                    showToast('Meeting created successfully!', 'success');
                    
                    // Generate meeting link and QR code
                    generateMeetingSharing(meeting);
                    
                    // Switch to sharing tab
                    document.querySelector('#sharing-tab').click();
                    
                    // Enable sharing buttons
                    document.getElementById('copyLinkBtn').disabled = false;
                    document.getElementById('testLinkBtn').disabled = false;
                    document.getElementById('downloadQRBtn').disabled = false;
                    document.getElementById('shareEmailBtn').disabled = false;
                    document.getElementById('shareWhatsAppBtn').disabled = false;
                    document.getElementById('shareSMSBtn').disabled = false;
                    
                    // Reload meetings list
                    loadMeetings();
                    loadUpcomingMeetings();
                    
                    // Update dashboard stats
                    loadDashboardData();
                    
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Failed to create meeting', 'error');
                }
            } catch (error) {
                console.error('Create meeting error:', error);
                showToast('Failed to create meeting', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Generate meeting sharing link and QR code
        function generateMeetingSharing(meeting) {
            // Store meeting code
            currentMeetingCode = meeting.accessCodes.publicCode;
            
            // Generate meeting link
            generatedMeetingLink = `${FRONTEND_URL}/attend/${currentMeetingCode}`;
            
            // Display the link
            document.getElementById('generatedLink').innerHTML = `
                <a href="${generatedMeetingLink}" target="_blank">${generatedMeetingLink}</a>
            `;
            
            // Generate QR code
            generateQRCode(generatedMeetingLink);
        }
        
        // Generate QR code
        function generateQRCode(text) {
            const qrContainer = document.getElementById('qrCodeCanvas');
            qrContainer.innerHTML = '';
            
            QRCode.toCanvas(text, { width: 200, margin: 2 }, function(error, canvas) {
                if (error) {
                    console.error('QR Code generation error:', error);
                    qrContainer.innerHTML = '<p class="text-danger">Failed to generate QR code</p>';
                    return;
                }
                
                canvas.className = 'qr-code-canvas';
                qrContainer.appendChild(canvas);
                generatedQRCode = canvas.toDataURL('image/png');
            });
        }
        
        // Copy meeting link to clipboard
        function copyMeetingLink() {
            if (!generatedMeetingLink) {
                showToast('No meeting link available', 'error');
                return;
            }
            
            navigator.clipboard.writeText(generatedMeetingLink).then(() => {
                showToast('Meeting link copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Copy failed:', err);
                showToast('Failed to copy link', 'error');
            });
        }
        
        // Test meeting link
        function testMeetingLink() {
            if (!generatedMeetingLink) {
                showToast('No meeting link available', 'error');
                return;
            }
            
            window.open(generatedMeetingLink, '_blank');
            showToast('Opening meeting link in new tab', 'info');
        }
        
        // Download QR code
        function downloadQRCode() {
            if (!generatedQRCode) {
                showToast('No QR code available', 'error');
                return;
            }
            
            const meetingTitle = document.getElementById('meetingTitle').value || 'meeting';
            const filename = `qr-code-${meetingTitle.replace(/\s+/g, '-').toLowerCase()}.png`;
            
            const link = document.createElement('a');
            link.href = generatedQRCode;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('QR code downloaded successfully!', 'success');
        }
        
        // Share via Email
        function shareViaEmail() {
            if (!generatedMeetingLink) {
                showToast('No meeting link available', 'error');
                return;
            }
            
            const meetingTitle = document.getElementById('meetingTitle').value || 'Meeting';
            const subject = `Join ${meetingTitle}`;
            const body = `You're invited to join ${meetingTitle}. Click the link below to join:\n\n${generatedMeetingLink}\n\nOr scan the attached QR code to join.`;
            
            const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
        }
        
        // Share via WhatsApp
        function shareViaWhatsApp() {
            if (!generatedMeetingLink) {
                showToast('No meeting link available', 'error');
                return;
            }
            
            const meetingTitle = document.getElementById('meetingTitle').value || 'Meeting';
            const text = `Join ${meetingTitle}: ${generatedMeetingLink}`;
            
            const whatsappLink = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(whatsappLink, '_blank');
        }
        
        // Share via SMS
        function shareViaSMS() {
            if (!generatedMeetingLink) {
                showToast('No meeting link available', 'error');
                return;
            }
            
            const meetingTitle = document.getElementById('meetingTitle').value || 'Meeting';
            const body = `Join ${meetingTitle}: ${generatedMeetingLink}`;
            
            const smsLink = `sms:?body=${encodeURIComponent(body)}`;
            window.location.href = smsLink;
        }
        
        // Create admin
        async function createAdmin() {
            try {
                const adminData = {
                    email: document.getElementById('adminEmail').value,
                    password: document.getElementById('adminPassword').value,
                    fullName: document.getElementById('adminFullName').value,
                    phone: document.getElementById('adminPhone').value,
                    role: document.getElementById('adminRole').value,
                    isActive: document.getElementById('adminStatus').value === 'active',
                    permissions: {
                        canCreateMeetings: document.getElementById('adminCanCreateMeetings').checked,
                        canEditMeetings: document.getElementById('adminCanEditMeetings').checked,
                        canDeleteMeetings: document.getElementById('adminCanDeleteMeetings').checked,
                        canViewReports: document.getElementById('adminCanViewReports').checked,
                        canManageAdmins: document.getElementById('adminCanManageAdmins').checked,
                        canApproveAttendance: document.getElementById('adminCanApproveAttendance').checked
                    }
                };
                
                const response = await fetch(`${API_BASE_URL}/admins`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(adminData)
                });
                
                if (response.ok) {
                    const admin = await response.json();
                    showToast('Admin created successfully!', 'success');
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('createAdminModal'));
                    modal.hide();
                    
                    // Reset form
                    document.getElementById('createAdminForm').reset();
                    
                    // Reload admins
                    loadAdmins();
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Failed to create admin', 'error');
                }
            } catch (error) {
                console.error('Create admin error:', error);
                showToast('Failed to create admin', 'error');
            }
        }
        
        // Add to your JavaScript

// Global variable to track meeting creation success data
let successMeetingData = null;

// Modify the createMeeting function to show success modal
async function createMeeting() {
    try {
        // Validate complete meeting creation form
        if (!validateMeetingCreation()) {
            return;
        }

        // Check if all sections are complete before allowing creation
        const isComplete = await validateMeetingSections();
        if (!isComplete) {
            showToast('Please complete all sections before creating meeting', 'error');
            return;
        }

        // Show loading
        showLoading();

        // ... existing create meeting code ...

        if (response.ok) {
            const meeting = await response.json();
            
            // Store success data for modal
            successMeetingData = {
                meetingId: meeting._id,
                title: meeting.title,
                shareLinks: meeting.shareLinks || generateMeetingLinks(meeting._id, meeting.accessCodes.publicCode),
                qrCode: meeting.qrCode,
                accessCodes: meeting.accessCodes
            };
            
            // Show success modal
            showSuccessModal(successMeetingData);
            
            // Don't close the create meeting modal yet
            // The user will close it after viewing success modal
        }
        // ... rest of existing code ...
    } catch (error) {
        console.error('Create meeting error:', error);
        showToast('Failed to create meeting', 'error');
    } finally {
        hideLoading();
    }
}

// Function to validate all sections are complete
async function validateMeetingSections() {
    const sections = [
        validateMeetingDetailsSection(),
        validateAttendanceFormSection(),
        validateShareQRCodeSection(),
        validateAdvancedSettingsSection()
    ];
    
    return sections.every(section => section);
}

// Individual section validations
function validateMeetingDetailsSection() {
    const title = document.getElementById('meetingTitle').value.trim();
    const locationName = document.getElementById('meetingLocationName').value.trim();
    const startTime = document.getElementById('meetingStartTime').value;
    const endTime = document.getElementById('meetingEndTime').value;
    const latitude = document.getElementById('meetingLatitude').value;
    const longitude = document.getElementById('meetingLongitude').value;
    
    return title && locationName && startTime && endTime && latitude && longitude;
}

function validateAttendanceFormSection() {
    const requireForm = document.getElementById('requireForm')?.checked || false;
    const formFields = currentMeetingFormFields;
    
    if (requireForm) {
        return formFields.length > 0;
    }
    return true; // Not required, so always valid
}

function validateShareQRCodeSection() {
    // This section is automatically completed when meeting is created
    return true;
}

function validateAdvancedSettingsSection() {
    const gpsEnabled = document.getElementById('allowGPSMeeting').checked;
    const smsEnabled = document.getElementById('allowSMSMeeting').checked;
    const ussdEnabled = document.getElementById('allowUSSDMeeting').checked;
    const kioskEnabled = document.getElementById('allowKioskMeeting').checked;
    const manualEnabled = document.getElementById('allowManualMeeting').checked;
    
    return gpsEnabled || smsEnabled || ussdEnabled || kioskEnabled || manualEnabled;
}

// Update create meeting button state
function updateCreateMeetingButtonState() {
    const createButton = document.querySelector('#createMeetingModal .btn-primary-custom');
    const isComplete = validateMeetingDetailsSection() && 
                      validateAttendanceFormSection() && 
                      validateAdvancedSettingsSection();
    
    createButton.disabled = !isComplete;
    if (isComplete) {
        createButton.innerHTML = '<i class="fas fa-check-circle me-2"></i> Create Meeting';
    } else {
        createButton.innerHTML = '<i class="fas fa-lock me-2"></i> Complete All Sections';
    }
}

// Add event listeners to update button state
function setupCreateMeetingValidation() {
    const inputs = [
        'meetingTitle', 'meetingLocationName', 'meetingStartTime', 
        'meetingEndTime', 'meetingLatitude', 'meetingLongitude'
    ];
    
    inputs.forEach(inputId => {
        const element = document.getElementById(inputId);
        if (element) {
            element.addEventListener('input', updateCreateMeetingButtonState);
            element.addEventListener('change', updateCreateMeetingButtonState);
        }
    });
    
    const checkboxes = [
        'allowGPSMeeting', 'allowSMSMeeting', 'allowUSSDMeeting',
        'allowKioskMeeting', 'allowManualMeeting', 'requireForm'
    ];
    
    checkboxes.forEach(checkboxId => {
        const element = document.getElementById(checkboxId);
        if (element) {
            element.addEventListener('change', updateCreateMeetingButtonState);
        }
    });
    
    // Initial state
    updateCreateMeetingButtonState();
}

// Show success modal
function showSuccessModal(data) {
    document.getElementById('successMeetingTitle').textContent = data.title;
    document.getElementById('successMeetingLink').innerHTML = 
        `<a href="${data.shareLinks.attendeeForm}" target="_blank">${data.shareLinks.attendeeForm}</a>`;
    
    // Display QR code
    const qrContainer = document.getElementById('successQRCode');
    qrContainer.innerHTML = '';
    if (data.qrCode) {
        qrContainer.innerHTML = `<img src="${data.qrCode}" alt="QR Code" class="img-fluid">`;
    } else {
        // Generate QR code if not provided
        QRCode.toCanvas(data.shareLinks.attendeeForm, { width: 200, margin: 2 }, function(error, canvas) {
            if (!error) {
                canvas.className = 'qr-code-canvas';
                qrContainer.appendChild(canvas);
                successMeetingData.generatedQRCode = canvas.toDataURL('image/png');
            }
        });
    }
    
    // Display access codes
    document.getElementById('successSmsCode').textContent = data.accessCodes.smsCode;
    document.getElementById('successUssdCode').textContent = data.accessCodes.ussdCode;
    document.getElementById('successPublicCode').textContent = data.accessCodes.publicCode;
    
    // Store the meeting link for sharing
    successMeetingData.meetingLink = data.shareLinks.attendeeForm;
    
    // Show modal
    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
    successModal.show();
    
    // Close create meeting modal
    const createModal = bootstrap.Modal.getInstance(document.getElementById('createMeetingModal'));
    if (createModal) {
        createModal.hide();
    }
}

// Success modal functions
function copySuccessLink() {
    if (successMeetingData?.meetingLink) {
        navigator.clipboard.writeText(successMeetingData.meetingLink).then(() => {
            showToast('Meeting link copied to clipboard!', 'success');
        });
    }
}

function downloadSuccessQRCode() {
    if (successMeetingData?.generatedQRCode) {
        const link = document.createElement('a');
        link.href = successMeetingData.generatedQRCode;
        link.download = `qr-code-${successMeetingData.title.replace(/\s+/g, '-').toLowerCase()}.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showToast('QR code downloaded!', 'success');
    }
}

function shareSuccessViaEmail() {
    if (successMeetingData?.meetingLink) {
        const subject = `Join ${successMeetingData.title}`;
        const body = `You're invited to join ${successMeetingData.title}. Click the link below to join:\n\n${successMeetingData.meetingLink}\n\nOr use these codes:\nSMS: ${successMeetingData.accessCodes.smsCode}\nUSSD: ${successMeetingData.accessCodes.ussdCode}`;
        window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }
}

function shareSuccessViaWhatsApp() {
    if (successMeetingData?.meetingLink) {
        const text = `Join ${successMeetingData.title}: ${successMeetingData.meetingLink}`;
        window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
    }
}

function shareSuccessViaSMS() {
    if (successMeetingData?.meetingLink) {
        const body = `Join ${successMeetingData.title}: ${successMeetingData.meetingLink}`;
        window.location.href = `sms:?body=${encodeURIComponent(body)}`;
    }
}

function shareSuccessViaCopy() {
    if (successMeetingData) {
        const text = `Meeting: ${successMeetingData.title}\nLink: ${successMeetingData.meetingLink}\nSMS Code: ${successMeetingData.accessCodes.smsCode}\nUSSD Code: ${successMeetingData.accessCodes.ussdCode}`;
        navigator.clipboard.writeText(text).then(() => {
            showToast('All meeting details copied!', 'success');
        });
    }
}

function goToMeetingDashboard() {
    if (successMeetingData?.meetingId) {
        // Close success modal
        const successModal = bootstrap.Modal.getInstance(document.getElementById('successModal'));
        if (successModal) successModal.hide();
        
        // Navigate to meetings section
        showDashboardSection('meetings');
        
        // Optionally highlight the new meeting
        setTimeout(() => {
            highlightNewMeeting(successMeetingData.meetingId);
        }, 500);
    }
}

function highlightNewMeeting(meetingId) {
    // This function would highlight the new meeting in the meetings table
    const row = document.querySelector(`[data-meeting-id="${meetingId}"]`);
    if (row) {
        row.classList.add('table-success');
        setTimeout(() => row.classList.remove('table-success'), 3000);
    }
}

        // Save settings
        async function saveSettings() {
            try {
                const settings = {
                    defaultLocationRadius: parseInt(document.getElementById('defaultRadius').value),
                    defaultTimeWindow: parseInt(document.getElementById('defaultTimeWindow').value),
                    allowGPS: document.getElementById('allowGPS').checked,
                    allowSMS: document.getElementById('allowSMS').checked,
                    allowUSSD: document.getElementById('allowUSSD').checked,
                    allowKiosk: document.getElementById('allowKiosk').checked,
                    allowManual: document.getElementById('allowManual').checked,
                    verificationStrictness: document.getElementById('verificationStrictness').value,
                    preventSameDevice: document.getElementById('preventSameDevice').checked,
                    preventSamePhone: document.getElementById('preventSamePhone').checked,
                    preventSameNameTime: document.getElementById('preventSameNameTime').checked
                };
                
                const response = await fetch(`${API_BASE_URL}/organization/settings`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ settings })
                });
                
                if (response.ok) {
                    const org = await response.json();
                    currentOrganization = org;
                    showToast('Settings saved successfully!', 'success');
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Failed to save settings', 'error');
                }
            } catch (error) {
                console.error('Save settings error:', error);
                showToast('Failed to save settings', 'error');
            }
        }
        
        // Save PWA settings
        function savePwaSettings() {
            const settings = {
                enablePWA: document.getElementById('enablePWA').checked,
                appName: document.getElementById('pwaAppName').value,
                themeColor: document.getElementById('pwaThemeColor').value,
                backgroundColor: document.getElementById('pwaBackgroundColor').value,
                pushNewAttendance: document.getElementById('pwaPushNewAttendance').checked,
                pushMeetingStart: document.getElementById('pwaPushMeetingStart').checked,
                pushReminders: document.getElementById('pwaPushReminders').checked,
                enableOffline: document.getElementById('enableOffline').checked
            };
            
            localStorage.setItem('pwaSettings', JSON.stringify(settings));
            showToast('PWA settings saved!', 'success');
            
            // Update preview
            document.getElementById('pwaPreviewName').textContent = settings.appName;
        }
        
        // Register current device
        function registerCurrentDevice() {
            const devices = JSON.parse(localStorage.getItem('registeredDevices') || '[]');
            
            const device = {
                id: 'device_' + Date.now(),
                userAgent: navigator.userAgent,
                registeredAt: new Date().toISOString(),
                lastSeen: new Date().toISOString()
            };
            
            devices.push(device);
            localStorage.setItem('registeredDevices', JSON.stringify(devices));
            
            showToast('Device registered successfully!', 'success');
            loadRegisteredDevices();
        }
        
        // Unregister device
        function unregisterDevice(deviceId) {
            let devices = JSON.parse(localStorage.getItem('registeredDevices') || '[]');
            devices = devices.filter(device => device.id !== deviceId);
            localStorage.setItem('registeredDevices', JSON.stringify(devices));
            
            showToast('Device unregistered', 'success');
            loadRegisteredDevices();
        }
        
        // Test push notification
        function testPushNotification() {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('GSAMS Test', {
                    body: 'This is a test notification from GSAMS',
                    icon: '/icons/icon-192x192.png',
                    tag: 'test-notification'
                });
                showToast('Test notification sent', 'success');
            } else {
                showToast('Please enable notifications first', 'warning');
            }
        }
        
        // Clear cache
        async function clearCache() {
            if ('caches' in window) {
                try {
                    await caches.delete('gsams-cache');
                    showToast('Cache cleared successfully', 'success');
                    updateCacheInfo();
                } catch (error) {
                    console.error('Clear cache error:', error);
                    showToast('Failed to clear cache', 'error');
                }
            } else {
                showToast('Cache API not supported', 'warning');
            }
        }
        
        // Update cache
        async function updateCache() {
            if (serviceWorkerRegistration) {
                try {
                    await serviceWorkerRegistration.update();
                    showToast('Cache updated successfully', 'success');
                    updateCacheInfo();
                } catch (error) {
                    console.error('Update cache error:', error);
                    showToast('Failed to update cache', 'error');
                }
            } else {
                showToast('Service Worker not registered', 'warning');
            }
        }
        
        // Test location
        async function testLocation() {
            const meetingCode = document.getElementById('testMeetingCode').value;
            const meetingId = document.getElementById('testMeetingSelect').value;
            const latitude = document.getElementById('testLatitude').value;
            const longitude = document.getElementById('testLongitude').value;
            const accuracy = document.getElementById('testAccuracy').value;
            
            if (!meetingCode && !meetingId) {
                showToast('Please enter a meeting code or select a meeting', 'error');
                return;
            }
            
            if (!latitude || !longitude) {
                showToast('Please enter latitude and longitude', 'error');
                return;
            }
            
            try {
                // Call location test API
                const response = await fetch(`${API_BASE_URL}/location/test`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        meetingCode: meetingCode || '',
                        latitude: parseFloat(latitude),
                        longitude: parseFloat(longitude),
                        accuracy: parseInt(accuracy)
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // Display results
                    const resultElement = document.getElementById('locationTestResult');
                    resultElement.className = 'location-status ' + (result.validation.wouldBeAccepted ? 'valid' : 'invalid');
                    
                    let resultHTML = `
                        <h6>Location Test Results</h6>
                        <div class="mt-3">
                            <strong>Meeting:</strong> ${result.meeting.title}<br>
                            <strong>Your Location:</strong> ${latitude}, ${longitude}<br>
                            <strong>Accuracy:</strong> ${accuracy}m<br>
                            <strong>Distance from Venue:</strong> ${result.validation.distance.toFixed(2)}m<br>
                            <strong>Within Radius:</strong> ${result.validation.withinRadius ? 'Yes' : 'No'} (${result.meeting.radius}m radius)<br>
                            <strong>Would be Accepted:</strong> ${result.validation.wouldBeAccepted ? '<span class="text-success">Yes</span>' : '<span class="text-danger">No</span>'}<br>
                            <strong>Confidence Score:</strong> ${result.validation.confidenceScore.toFixed(1)}%
                        </div>
                    `;
                    
                    if (result.validation.messages.length > 0) {
                        resultHTML += `
                            <div class="mt-3">
                                <strong>Messages:</strong>
                                <ul class="mb-0">
                                    ${result.validation.messages.map(msg => `<li>${msg}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    }
                    
                    if (result.validation.spoofingDetection.warnings.length > 0) {
                        resultHTML += `
                            <div class="mt-3 alert alert-warning">
                                <strong>Spoofing Warnings:</strong>
                                <ul class="mb-0">
                                    ${result.validation.spoofingDetection.warnings.map(warning => `<li>${warning}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    }
                    
                    if (result.recommendations.length > 0) {
                        resultHTML += `
                            <div class="mt-3">
                                <strong>Recommendations:</strong>
                                <ul class="mb-0">
                                    ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    }
                    
                    resultElement.innerHTML = resultHTML;
                    resultElement.classList.remove('d-none');
                    
                    // Save to history
                    saveLocationTestHistory(result);
                    
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Location test failed', 'error');
                }
            } catch (error) {
                console.error('Location test error:', error);
                showToast('Failed to test location', 'error');
            }
        }
        
        // Save location test history
        function saveLocationTestHistory(result) {
            const history = JSON.parse(localStorage.getItem('locationTestHistory') || '[]');
            
            history.unshift({
                timestamp: new Date().toISOString(),
                meeting: result.meeting.title,
                coordinates: `${result.yourLocation.latitude}, ${result.yourLocation.longitude}`,
                distance: result.validation.distance,
                accuracy: result.yourLocation.accuracy,
                accepted: result.validation.wouldBeAccepted,
                details: result.validation
            });
            
            // Keep only last 10 tests
            if (history.length > 10) {
                history.pop();
            }
            
            localStorage.setItem('locationTestHistory', JSON.stringify(history));
            updateLocationTestHistory(history);
        }
        
        // Update location test history display
        function updateLocationTestHistory(history) {
            const tbody = document.getElementById('locationTestHistory');
            
            if (history.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <p class="text-muted">No location tests recorded yet</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            history.forEach(test => {
                const time = new Date(test.timestamp);
                html += `
                    <tr>
                        <td>${test.meeting}</td>
                        <td>${time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>
                        <td>${test.coordinates}</td>
                        <td>${test.distance.toFixed(2)}m</td>
                        <td>${test.accuracy}m</td>
                        <td>
                            <span class="badge bg-${test.accepted ? 'success' : 'danger'}">
                                ${test.accepted ? 'Accepted' : 'Rejected'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewTestDetails(${JSON.stringify(test).replace(/"/g, '&quot;')})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // View test details
        function viewTestDetails(test) {
            alert(`
Meeting: ${test.meeting}
Time: ${new Date(test.timestamp).toLocaleString()}
Coordinates: ${test.coordinates}
Distance: ${test.distance.toFixed(2)}m
Accuracy: ${test.accuracy}m
Result: ${test.accepted ? 'Accepted' : 'Rejected'}
Confidence Score: ${test.details.confidenceScore.toFixed(1)}%
            `);
        }
        
        // Show create meeting modal
        function showCreateMeetingModal() {
            // Reset form builder
            currentMeetingFormFields = [];
            document.getElementById('formFieldsList').innerHTML = '<div class="alert alert-info">No fields added yet. Click "Add Field" to create your first form field.</div>';
            updateFormPreview();
            
            // Reset sharing section
            document.getElementById('generatedLink').innerHTML = '<span class="text-muted">Link will be generated after meeting creation</span>';
            document.getElementById('qrCodeCanvas').innerHTML = '';
            document.getElementById('copyLinkBtn').disabled = true;
            document.getElementById('testLinkBtn').disabled = true;
            document.getElementById('downloadQRBtn').disabled = true;
            document.getElementById('shareEmailBtn').disabled = true;
            document.getElementById('shareWhatsAppBtn').disabled = true;
            document.getElementById('shareSMSBtn').disabled = true;
            
            // Set default values
            const now = new Date();
            const future = new Date(now.getTime() + 24 * 60 * 60 * 1000); // Tomorrow
            
            document.getElementById('meetingStartTime').value = formatDateTimeLocal(future);
            document.getElementById('meetingEndTime').value = formatDateTimeLocal(new Date(future.getTime() + 2 * 60 * 60 * 1000)); // 2 hours later
            
            // Reset advanced settings
            document.getElementById('minimumStayContainer').style.display = 'none';
            
            // Reset to first tab
            document.querySelector('#meetingTabs .nav-link').click();
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('createMeetingModal'));
            modal.show();
        }
        
        // Show create admin modal
        function showCreateAdminModal() {
            const modal = new bootstrap.Modal(document.getElementById('createAdminModal'));
            modal.show();
        }
        
        // Show location test modal
        function showLocationTestModal() {
            const modal = new bootstrap.Modal(document.getElementById('locationTestModal'));
            
            // Populate modal content
            document.getElementById('locationTestModalContent').innerHTML = `
                <div class="location-test-panel">
                    <h6 class="mb-4">Test Location Verification</h6>
                    
                    <div class="mb-4">
                        <p class="text-muted">Enter coordinates to test if they would be accepted for attendance.</p>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">Meeting Code</label>
                                <input type="text" class="form-control" id="modalTestMeetingCode" placeholder="Enter meeting code">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">Latitude</label>
                                <input type="number" step="any" class="form-control" id="modalTestLatitude" placeholder="Enter latitude">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">Longitude</label>
                                <input type="number" step="any" class="form-control" id="modalTestLongitude" placeholder="Enter longitude">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">Accuracy (meters)</label>
                                <input type="number" class="form-control" id="modalTestAccuracy" value="10" min="1" max="1000">
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button class="btn btn-primary-custom" onclick="modalTestLocation()">
                            <i class="fas fa-map-marker-alt me-2"></i> Test Location
                        </button>
                    </div>
                    
                    <div id="modalLocationTestResult" class="mt-4">
                        <!-- Results will appear here -->
                    </div>
                </div>
            `;
            
            modal.show();
        }
        
        // Modal location test
        async function modalTestLocation() {
            const meetingCode = document.getElementById('modalTestMeetingCode').value;
            const latitude = document.getElementById('modalTestLatitude').value;
            const longitude = document.getElementById('modalTestLongitude').value;
            const accuracy = document.getElementById('modalTestAccuracy').value;
            
            if (!meetingCode || !latitude || !longitude) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/location/test`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        meetingCode,
                        latitude: parseFloat(latitude),
                        longitude: parseFloat(longitude),
                        accuracy: parseInt(accuracy)
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    const resultElement = document.getElementById('modalLocationTestResult');
                    let resultHTML = `
                        <div class="location-status ${result.validation.wouldBeAccepted ? 'valid' : 'invalid'}">
                            <h6>Test Results</h6>
                            <p class="mb-1"><strong>Meeting:</strong> ${result.meeting.title}</p>
                            <p class="mb-1"><strong>Result:</strong> ${result.validation.wouldBeAccepted ? ' Accepted' : ' Rejected'}</p>
                            <p class="mb-1"><strong>Distance:</strong> ${result.validation.distance.toFixed(2)}m (Radius: ${result.meeting.radius}m)</p>
                            <p class="mb-1"><strong>Confidence:</strong> ${result.validation.confidenceScore.toFixed(1)}%</p>
                        </div>
                    `;
                    
                    if (result.validation.messages.length > 0) {
                        resultHTML += `
                            <div class="alert alert-info mt-3">
                                <strong>Messages:</strong>
                                <ul class="mb-0">
                                    ${result.validation.messages.map(msg => `<li>${msg}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    }
                    
                    resultElement.innerHTML = resultHTML;
                    
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Location test failed', 'error');
                }
            } catch (error) {
                console.error('Modal location test error:', error);
                showToast('Failed to test location', 'error');
            }
        }
        
        // Show real-time monitoring
        function showRealTimeMonitoring() {
            const modal = new bootstrap.Modal(document.getElementById('realTimeMonitoringModal'));
            
            // Start live updates for modal
            const modalInterval = setInterval(() => {
                updateModalLiveFeed();
            }, 5000);
            
            // Update on modal show
            updateModalLiveFeed();
            
            // Clear interval when modal closes
            modal._element.addEventListener('hidden.bs.modal', () => {
                clearInterval(modalInterval);
            });
            
            modal.show();
        }
        
        // Update modal live feed
        async function updateModalLiveFeed() {
            try {
                // Get active meetings attendance
                const response = await fetch(`${API_BASE_URL}/dashboard/stats`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Update stats
                    document.getElementById('monitoringActiveAttendees').textContent = data.summary.todayAttendance || 0;
                    document.getElementById('monitoringTotalAttendees').textContent = data.summary.totalAttendance || 0;
                    document.getElementById('monitoringVerified').textContent = data.recentAttendance?.filter(a => a.status === 'verified').length || 0;
                    document.getElementById('monitoringPending').textContent = data.recentAttendance?.filter(a => a.status === 'pending').length || 0;
                    
                    // Update feed
                    updateModalLiveFeedDisplay(data.recentAttendance);
                }
            } catch (error) {
                console.error('Modal live feed error:', error);
            }
        }
        
        // Update modal live feed display
        function updateModalLiveFeedDisplay(attendance) {
            const feedContainer = document.getElementById('modalLiveFeed');
            if (!attendance || attendance.length === 0) {
                feedContainer.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-muted">No recent attendance</p>
                    </div>
                `;
                return;
            }
            
            let feedHTML = '';
            attendance.slice(0, 10).forEach(record => {
                const time = new Date(record.createdAt);
                const timeStr = time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Get method icon
                let methodIcon = 'fa-map-marker-alt';
                let methodClass = 'gps';
                switch(record.verificationType) {
                    case 'sms': methodIcon = 'fa-sms'; methodClass = 'sms'; break;
                    case 'ussd': methodIcon = 'fa-mobile-alt'; methodClass = 'ussd'; break;
                    case 'kiosk': methodIcon = 'fa-desktop'; methodClass = 'kiosk'; break;
                    case 'manual': methodIcon = 'fa-user-check'; methodClass = 'manual'; break;
                }
                
                feedHTML += `
                    <div class="live-feed-item attendance-card ${methodClass}">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas ${methodIcon} me-2"></i>
                                <strong>${record.attendeeInfo.fullName}</strong>
                            </div>
                            <div>
                                <span class="badge bg-${record.status === 'verified' ? 'success' : 'warning'}">
                                    ${record.status}
                                </span>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <small class="text-muted">
                                ${record.meetingId?.title || 'Meeting'}
                            </small>
                            <small class="text-muted">${timeStr}</small>
                        </div>
                    </div>
                `;
            });
            
            feedContainer.innerHTML = feedHTML;
            
            // Add animation to new items
            const items = feedContainer.querySelectorAll('.live-feed-item');
            items.forEach(item => {
                item.classList.add('new');
                setTimeout(() => item.classList.remove('new'), 2000);
            });
        }
        
        // Show meeting details modal
        function showMeetingDetailsModal(meetingId) {
            // Fetch meeting details
            fetch(`${API_BASE_URL}/meetings/${meetingId}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(meeting => {
                const startTime = new Date(meeting.schedule.startTime);
                const endTime = new Date(meeting.schedule.endTime);
                
                // Generate sharing link
                const meetingLink = `${FRONTEND_URL}/attend/${meeting.accessCodes.publicCode}`;
                
                let qrCodeHTML = '<p class="text-muted">Generating QR code...</p>';
                
                // Generate methods badges
                const methods = [];
                if (meeting.attendanceConfig.allowedModes.smartphoneGPS) methods.push('GPS');
                if (meeting.attendanceConfig.allowedModes.sms) methods.push('SMS');
                if (meeting.attendanceConfig.allowedModes.ussd) methods.push('USSD');
                if (meeting.attendanceConfig.allowedModes.kiosk) methods.push('Kiosk');
                if (meeting.attendanceConfig.allowedModes.manual) methods.push('Manual');
                
                document.getElementById('meetingDetailsContent').innerHTML = `
                    <div class="row">
                        <div class="col-md-8">
                            <div class="d-flex justify-content-between align-items-start">
                                <h5>${meeting.title}</h5>
                                <div>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteMeeting('${meeting._id}')">
                                        <i class="fas fa-trash me-1"></i> Delete Meeting
                                    </button>
                                </div>
                            </div>
                            <p class="text-muted">${meeting.description || 'No description provided'}</p>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <h6><i class="fas fa-calendar me-2"></i> Schedule</h6>
                                    <p><strong>Start:</strong> ${startTime.toLocaleString()}</p>
                                    <p><strong>End:</strong> ${endTime.toLocaleString()}</p>
                                    <p><strong>Status:</strong> ${getMeetingStatusBadge(meeting.status)}</p>
                                </div>
                                <div class="col-md-6">
                                    <h6><i class="fas fa-map-marker-alt me-2"></i> Location</h6>
                                    <p><strong>Name:</strong> ${meeting.location.name}</p>
                                    <p><strong>Radius:</strong> ${meeting.location.radius} meters</p>
                                    <p><strong>Coordinates:</strong> ${meeting.location.latitude.toFixed(6)}, ${meeting.location.longitude.toFixed(6)}</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h6><i class="fas fa-tools me-2"></i> Attendance Methods</h6>
                                <div class="d-flex gap-2 mt-2">
                                    ${methods.map(method => `<span class="badge bg-primary">${method}</span>`).join('')}
                                </div>
                            </div>
                            
                            ${meeting.customFormFields && meeting.customFormFields.length > 0 ? `
                                <div class="mt-4">
                                    <h6><i class="fas fa-list-alt me-2"></i> Custom Form Fields</h6>
                                    <p class="text-muted small">${meeting.requireForm ? 'Required' : 'Optional'} for attendees</p>
                                    <ul class="list-group mt-2">
                                        ${meeting.customFormFields.map(field => `
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                ${field.label}
                                                <span class="badge bg-secondary">${field.type} ${field.required ? ' (Required)' : ''}</span>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${meeting.timeVerification ? `
                                <div class="mt-4">
                                    <h6><i class="fas fa-clock me-2"></i> Time Verification</h6>
                                    <p class="text-muted small">
                                        ${meeting.timeVerification.requireMinimumStay ? 
                                            `Minimum stay: ${meeting.timeVerification.minimumStayMinutes} minutes` : 
                                            'No minimum stay requirement'}
                                    </p>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="col-md-4">
                            <div class="share-section">
                                <h6><i class="fas fa-share-alt me-2"></i> Share Meeting</h6>
                                
                                <div class="mt-3">
                                    <p class="small text-muted">Meeting Link:</p>
                                    <div class="share-link mb-3">
                                        <a href="${meetingLink}" target="_blank">${meetingLink}</a>
                                    </div>
                                    
                                    <div class="d-flex gap-2 mb-3">
                                        <button class="btn btn-sm btn-primary-custom flex-grow-1" onclick="copyTextToClipboard('${meetingLink}')">
                                            <i class="fas fa-copy me-1"></i> Copy Link
                                        </button>
                                        <button class="btn btn-sm btn-outline-custom" onclick="window.open('${meetingLink}', '_blank')">
                                            <i class="fas fa-external-link-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mt-4 text-center">
                                    <h6><i class="fas fa-qrcode me-2"></i> QR Code</h6>
                                    <div id="meetingQRCode" class="mt-2 mb-3">
                                        ${qrCodeHTML}
                                    </div>
                                    <button class="btn btn-sm btn-primary-custom w-100" onclick="downloadMeetingQRCode('${meetingLink}', '${meeting.title}')">
                                        <i class="fas fa-download me-1"></i> Download QR Code
                                    </button>
                                </div>
                                
                                <div class="mt-4">
                                    <h6>Access Codes</h6>
                                    <div class="mt-2">
                                        <p class="mb-1"><small>SMS Code:</small> <code>${meeting.accessCodes.smsCode}</code></p>
                                        <p class="mb-1"><small>USSD Code:</small> <code>${meeting.accessCodes.ussdCode}</code></p>
                                        <p class="mb-1"><small>Public Code:</small> <code>${meeting.accessCodes.publicCode}</code></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Generate QR code
                QRCode.toDataURL(meetingLink, { width: 150, margin: 1 }, function(error, url) {
                    if (!error) {
                        document.getElementById('meetingQRCode').innerHTML = `<img src="${url}" alt="QR Code" class="img-fluid">`;
                    }
                });
                
                const modal = new bootstrap.Modal(document.getElementById('meetingDetailsModal'));
                modal.show();
            })
            .catch(error => {
                console.error('Meeting details error:', error);
                document.getElementById('meetingDetailsContent').innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                        <h5>Error Loading Meeting Details</h5>
                        <p class="text-muted">Failed to load meeting information</p>
                    </div>
                `;
                const modal = new bootstrap.Modal(document.getElementById('meetingDetailsModal'));
                modal.show();
            });
        }
        
        // Helper function for meeting status badge
        function getMeetingStatusBadge(status) {
            switch(status) {
                case 'draft': return '<span class="badge bg-secondary">Draft</span>';
                case 'active': return '<span class="badge bg-success">Active</span>';
                case 'in_progress': return '<span class="badge bg-primary">In Progress</span>';
                case 'completed': return '<span class="badge bg-info">Completed</span>';
                case 'cancelled': return '<span class="badge bg-danger">Cancelled</span>';
                default: return '<span class="badge bg-secondary">Unknown</span>';
            }
        }
        
        // Helper function to copy text to clipboard
        function copyTextToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Copy failed:', err);
                showToast('Failed to copy', 'error');
            });
        }
        
        // Download meeting QR code
        function downloadMeetingQRCode(link, title) {
            QRCode.toDataURL(link, { width: 300, margin: 2 }, function(error, url) {
                if (error) {
                    showToast('Failed to generate QR code', 'error');
                    return;
                }
                
                const filename = `qr-code-${title.replace(/\s+/g, '-').toLowerCase()}.png`;
                const downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = filename;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                showToast('QR code downloaded!', 'success');
            });
        }
        
        // Delete meeting
        // Enhanced deleteMeeting function
async function deleteMeeting(meetingId) {
  if (!confirm('Are you sure you want to delete this meeting? This action cannot be undone.')) {
    return;
  }
  
  // Ask for confirmation if the meeting might have attendance
  const meeting = window.currentMeetings?.find(m => m._id === meetingId);
  let forceDelete = false;
  
  if (meeting && meeting.attendanceCount > 0) {
    const confirmForce = confirm(`This meeting has ${meeting.attendanceCount} attendance records.\n\nDo you want to delete it anyway?\n\nClick OK to force delete, Cancel to abort.`);
    if (!confirmForce) return;
    forceDelete = true;
  }
  
  // Ask for delete type
  const deleteType = confirm('Do you want to permanently delete this meeting?\n\nOK = Permanent delete\nCancel = Mark as cancelled');
  
  try {
    // Build query parameters
    const params = new URLSearchParams();
    if (forceDelete) params.append('force', 'true');
    if (deleteType) params.append('hardDelete', 'true');
    if (deleteType) params.append('deleteAttendance', 'true');
    
    const url = `${API_BASE_URL}/meetings/${meetingId}${params.toString() ? '?' + params.toString() : ''}`;
    
    showLoading();
    
    const response = await fetch(url, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${authToken}`,
        'Content-Type': 'application/json'
      }
    });
    
    const data = await response.json();
    
    if (response.ok) {
      showToast(data.message || 'Meeting deleted successfully!', 'success');
      
      // Reload meetings
      loadMeetings();
      loadUpcomingMeetings();
      
      // Update dashboard stats
      loadDashboardData();
      
      // Close modal if open
      const modal = bootstrap.Modal.getInstance(document.getElementById('meetingDetailsModal'));
      if (modal) modal.hide();
    } else {
      showToast(data.error || data.message || 'Failed to delete meeting', 'error');
      
      // Show detailed error message if available
      if (data.suggestions) {
        setTimeout(() => {
          alert(`Error: ${data.message}\n\nSuggestions:\n${data.suggestions.join('\n')}`);
        }, 100);
      }
    }
  } catch (error) {
    console.error('Delete meeting error:', error);
    showToast('Failed to delete meeting. Please try again.', 'error');
  } finally {
    hideLoading();
  }
}
        // Export report
        function exportReport(format) {
            const meetingId = document.getElementById('attendanceMeetingFilter').value;
            
            if (!meetingId) {
                showToast('Please select a meeting first', 'warning');
                return;
            }
            
            let url;
            if (format === 'pdf') {
                url = `${API_BASE_URL}/meetings/${meetingId}/export/pdf`;
            } else if (format === 'excel') {
                url = `${API_BASE_URL}/meetings/${meetingId}/export/excel`;
            }
            
            // Create a temporary link to trigger download
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', '');
            link.setAttribute('target', '_blank');
            
            // Add authorization header
            link.setAttribute('Authorization', `Bearer ${authToken}`);
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast(`Exporting ${format.toUpperCase()} report...`, 'info');
        }
        
        // Export all meetings report
        function exportAllMeetingsReport() {
            const url = `${API_BASE_URL}/organization/meetings/export/pdf`;
            
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', '');
            link.setAttribute('target', '_blank');
            link.setAttribute('Authorization', `Bearer ${authToken}`);
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Exporting all meetings report...', 'info');
        }
        
        // Export location analytics
        function exportLocationAnalytics() {
            showToast('Location analytics export coming soon!', 'info');
        }
        
        // Export all attendance
        function exportAllAttendance() {
            showToast('Exporting all attendance data...', 'info');
            // This would call the API to export all attendance
        }
        
        // Export all meetings
        function exportAllMeetings() {
            showToast('Exporting all meetings...', 'info');
            // This would call the API to export all meetings
        }
        
        // Regenerate API key
        function regenerateApiKey() {
            // In a real implementation, this would call an API endpoint
            // For now, we'll simulate it
            const newKey = generateApiKey();
            document.getElementById('apiKey').textContent = newKey;
            showToast('API key regenerated successfully', 'success');
        }
        
        // Update meetings table
        function updateMeetingsTable(meetings) {
            const tbody = document.getElementById('meetingsTable');
            tbody.innerHTML = '';
            
            if (meetings.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <i class="fas fa-calendar-times fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No meetings found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            meetings.forEach(meeting => {
                const row = document.createElement('tr');
                
                // Format date
                const startTime = new Date(meeting.schedule.startTime);
                const dateStr = startTime.toLocaleDateString() + ' ' + startTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Get attendance methods
                const methods = [];
                if (meeting.attendanceConfig.allowedModes.smartphoneGPS) methods.push('GPS');
                if (meeting.attendanceConfig.allowedModes.sms) methods.push('SMS');
                if (meeting.attendanceConfig.allowedModes.ussd) methods.push('USSD');
                if (meeting.attendanceConfig.allowedModes.kiosk) methods.push('Kiosk');
                if (meeting.attendanceConfig.allowedModes.manual) methods.push('Manual');
                
                // Status badge
                let statusBadge;
                switch(meeting.status) {
                    case 'draft': statusBadge = '<span class="badge bg-secondary">Draft</span>'; break;
                    case 'active': statusBadge = '<span class="badge bg-success">Active</span>'; break;
                    case 'in_progress': statusBadge = '<span class="badge bg-primary">In Progress</span>'; break;
                    case 'completed': statusBadge = '<span class="badge bg-info">Completed</span>'; break;
                    case 'cancelled': statusBadge = '<span class="badge bg-danger">Cancelled</span>'; break;
                    default: statusBadge = '<span class="badge bg-secondary">Unknown</span>';
                }
                
                // Get attendance count (this would come from API in real implementation)
                const attendanceCount = 0; // Placeholder
                
                row.innerHTML = `
                    <td>${meeting.title}</td>
                    <td>${dateStr}</td>
                    <td>${meeting.location.name}</td>
                    <td>${methods.join(', ')}</td>
                    <td>${statusBadge}</td>
                    <td>${attendanceCount}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="showMeetingDetailsModal('${meeting._id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-success me-1" onclick="startMeeting('${meeting._id}')">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteMeeting('${meeting._id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update upcoming meetings table
        function updateUpcomingMeetingsTable(meetings) {
            const tbody = document.getElementById('upcomingMeetings');
            tbody.innerHTML = '';
            
            if (meetings.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center py-4">
                            <i class="fas fa-calendar-plus fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No upcoming meetings</p>
                            <button class="btn btn-sm btn-primary-custom" onclick="showCreateMeetingModal()">
                                Create Your First Meeting
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Show only first 5 meetings
            const displayMeetings = meetings.slice(0, 5);
            
            displayMeetings.forEach(meeting => {
                const row = document.createElement('tr');
                
                // Format date
                const startTime = new Date(meeting.schedule.startTime);
                const dateStr = startTime.toLocaleDateString() + ' ' + startTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Status badge
                let statusBadge;
                switch(meeting.status) {
                    case 'draft': statusBadge = '<span class="badge bg-secondary">Draft</span>'; break;
                    case 'active': statusBadge = '<span class="badge bg-success">Active</span>'; break;
                    case 'in_progress': statusBadge = '<span class="badge bg-primary">In Progress</span>'; break;
                    default: statusBadge = '<span class="badge bg-secondary">Unknown</span>';
                }
                
                row.innerHTML = `
                    <td>${meeting.title}</td>
                    <td>${dateStr}</td>
                    <td>${meeting.location.name}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="showMeetingDetailsModal('${meeting._id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-success me-1" onclick="startMeeting('${meeting._id}')">
                            <i class="fas fa-play"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update attendance table
        function updateAttendanceTable(attendance) {
            const tbody = document.getElementById('attendanceTable');
            tbody.innerHTML = '';
            
            if (attendance.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <i class="fas fa-user-times fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No attendance records found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            attendance.forEach(record => {
                const row = document.createElement('tr');
                
                // Format time
                const checkInTime = new Date(record.timeTracking.checkInTime);
                const timeStr = checkInTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Verification type
                let typeBadge;
                switch(record.verificationType) {
                    case 'smartphone_gps': typeBadge = '<span class="badge bg-primary">GPS</span>'; break;
                    case 'sms': typeBadge = '<span class="badge bg-info">SMS</span>'; break;
                    case 'ussd': typeBadge = '<span class="badge bg-warning">USSD</span>'; break;
                    case 'kiosk': typeBadge = '<span class="badge bg-secondary">Kiosk</span>'; break;
                    case 'manual': typeBadge = '<span class="badge bg-success">Manual</span>'; break;
                    default: typeBadge = '<span class="badge bg-secondary">Unknown</span>';
                }
                
                // Confidence indicator
                let confidenceClass = 'bg-danger';
                if (record.verificationDetails.confidenceScore >= 70) confidenceClass = 'bg-success';
                else if (record.verificationDetails.confidenceScore >= 40) confidenceClass = 'bg-warning';
                
                // Status badge
                let statusBadge;
                switch(record.status) {
                    case 'pending': statusBadge = '<span class="badge bg-warning">Pending</span>'; break;
                    case 'verified': statusBadge = '<span class="badge bg-success">Verified</span>'; break;
                    case 'flagged': statusBadge = '<span class="badge bg-danger">Flagged</span>'; break;
                    case 'rejected': statusBadge = '<span class="badge bg-secondary">Rejected</span>'; break;
                    default: statusBadge = '<span class="badge bg-secondary">Unknown</span>';
                }
                
                row.innerHTML = `
                    <td>${record.attendeeInfo.fullName}</td>
                    <td>${record.meetingId?.title || 'Meeting'}</td>
                    <td>${typeBadge}</td>
                    <td>${timeStr}</td>
                    <td>${record.locationData.isWithinRadius ? 'Within Radius' : 'Outside Radius'}</td>
                    <td>
                        <div class="confidence-bar">
                            <div class="confidence-fill ${confidenceClass}" style="width: ${record.verificationDetails.confidenceScore}%"></div>
                        </div>
                        <small>${record.verificationDetails.confidenceScore}%</small>
                    </td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="viewAttendanceDetails('${record._id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-success me-1" onclick="verifyAttendance('${record._id}')">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="rejectAttendance('${record._id}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update admins table
        function updateAdminsTable(admins) {
            const tbody = document.getElementById('adminsTable');
            tbody.innerHTML = '';
            
            if (admins.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <i class="fas fa-users fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No admins found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            admins.forEach(admin => {
                const row = document.createElement('tr');
                
                // Format last login
                let lastLoginStr = 'Never';
                if (admin.lastLogin) {
                    const lastLogin = new Date(admin.lastLogin);
                    lastLoginStr = lastLogin.toLocaleDateString();
                }
                
                // Role badge
                let roleBadge;
                switch(admin.role) {
                    case 'super_admin': roleBadge = '<span class="badge bg-danger">Super Admin</span>'; break;
                    case 'admin': roleBadge = '<span class="badge bg-primary">Admin</span>'; break;
                    case 'viewer': roleBadge = '<span class="badge bg-secondary">Viewer</span>'; break;
                    default: roleBadge = '<span class="badge bg-secondary">Unknown</span>';
                }
                
                // Status badge
                const statusBadge = admin.isActive ? 
                    '<span class="badge bg-success">Active</span>' : 
                    '<span class="badge bg-danger">Inactive</span>';
                
                // Permissions summary
                const permissions = [];
                if (admin.permissions?.canCreateMeetings) permissions.push('Create');
                if (admin.permissions?.canEditMeetings) permissions.push('Edit');
                if (admin.permissions?.canDeleteMeetings) permissions.push('Delete');
                if (admin.permissions?.canViewReports) permissions.push('Reports');
                if (admin.permissions?.canManageAdmins) permissions.push('Manage');
                if (admin.permissions?.canApproveAttendance) permissions.push('Approve');
                
                row.innerHTML = `
                    <td>${admin.fullName}</td>
                    <td>${admin.email}</td>
                    <td>${admin.phone || '-'}</td>
                    <td>${roleBadge}</td>
                    <td>${permissions.join(', ')}</td>
                    <td>${statusBadge}</td>
                    <td>${lastLoginStr}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="editAdmin('${admin._id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteAdmin('${admin._id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update audit logs table
        function updateAuditLogsTable(logs) {
            const tbody = document.getElementById('auditLogsTable');
            tbody.innerHTML = '';
            
            if (logs.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-4">
                            <i class="fas fa-clipboard-list fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No audit logs found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            logs.forEach(log => {
                const row = document.createElement('tr');
                
                // Format timestamp
                const timestamp = new Date(log.timestamp);
                const timeStr = timestamp.toLocaleDateString() + ' ' + timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                row.innerHTML = `
                    <td>${timeStr}</td>
                    <td>${log.userId?.fullName || 'System'}</td>
                    <td>${log.action.replace(/_/g, ' ')}</td>
                    <td>${log.entityType || '-'}</td>
                    <td>${JSON.stringify(log.details || {}).substring(0, 50)}...</td>
                    <td>${log.ipAddress || '-'}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update recent attendance
        function updateRecentAttendance(attendance) {
            const tbody = document.getElementById('recentAttendance');
            tbody.innerHTML = '';
            
            if (!attendance || attendance.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-3">
                            <p class="text-muted mb-0">No recent attendance</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            attendance.forEach(record => {
                const row = document.createElement('tr');
                
                // Format time
                const checkInTime = new Date(record.createdAt);
                const timeStr = checkInTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Verification type
                let typeBadge;
                switch(record.verificationType) {
                    case 'smartphone_gps': typeBadge = '<span class="badge bg-primary">GPS</span>'; break;
                    case 'sms': typeBadge = '<span class="badge bg-info">SMS</span>'; break;
                    case 'ussd': typeBadge = '<span class="badge bg-warning">USSD</span>'; break;
                    case 'kiosk': typeBadge = '<span class="badge bg-secondary">Kiosk</span>'; break;
                    case 'manual': typeBadge = '<span class="badge bg-success">Manual</span>'; break;
                    default: typeBadge = '<span class="badge bg-secondary">Unknown</span>';
                }
                
                // Status badge
                let statusBadge;
                switch(record.status) {
                    case 'pending': statusBadge = '<span class="badge bg-warning">Pending</span>'; break;
                    case 'verified': statusBadge = '<span class="badge bg-success">Verified</span>'; break;
                    case 'flagged': statusBadge = '<span class="badge bg-danger">Flagged</span>'; break;
                    case 'rejected': statusBadge = '<span class="badge bg-secondary">Rejected</span>'; break;
                    default: statusBadge = '<span class="badge bg-secondary">Unknown</span>';
                }
                
                // Confidence indicator
                let confidenceClass = 'bg-danger';
                if (record.verificationDetails?.confidenceScore >= 70) confidenceClass = 'bg-success';
                else if (record.verificationDetails?.confidenceScore >= 40) confidenceClass = 'bg-warning';
                const confidenceScore = record.verificationDetails?.confidenceScore || 0;
                
                row.innerHTML = `
                    <td>${record.attendeeInfo.fullName}</td>
                    <td>${record.meetingId?.title || 'Meeting'}</td>
                    <td>${typeBadge}</td>
                    <td>${timeStr}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <div class="confidence-bar">
                            <div class="confidence-fill ${confidenceClass}" style="width: ${confidenceScore}%"></div>
                        </div>
                        <small>${confidenceScore}%</small>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update meeting filter dropdown
        function updateMeetingFilter(meetings) {
            const select = document.getElementById('attendanceMeetingFilter');
            
            // Clear existing options except the first one
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            meetings.forEach(meeting => {
                const option = document.createElement('option');
                option.value = meeting._id;
                option.textContent = meeting.title;
                select.appendChild(option);
            });
        }
        
        // Update attendance chart
        function updateAttendanceChart(byType) {
            const ctx = document.getElementById('attendanceChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (attendanceChart) {
                attendanceChart.destroy();
            }
            
            // Prepare data
            const labels = [];
            const data = [];
            const colors = ['#4361ee', '#3f37c9', '#4cc9f0', '#f72585', '#f8961e'];
            
            if (byType && byType.length > 0) {
                byType.forEach((type, index) => {
                    let label;
                    switch(type._id) {
                        case 'smartphone_gps': label = 'GPS'; break;
                        case 'sms': label = 'SMS'; break;
                        case 'ussd': label = 'USSD'; break;
                        case 'kiosk': label = 'Kiosk'; break;
                        case 'manual': label = 'Manual'; break;
                        default: label = type._id;
                    }
                    
                    labels.push(label);
                    data.push(type.count);
                });
            } else {
                // Default data
                labels.push('GPS', 'SMS', 'USSD', 'Kiosk', 'Manual');
                data.push(0, 0, 0, 0, 0);
            }
            
            // Create chart
            attendanceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Update trend chart
        function updateTrendChart(trendData) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (trendChart) {
                trendChart.destroy();
            }
            
            // Create chart
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: trendData.labels,
                    datasets: [{
                        label: 'Attendance',
                        data: trendData.data,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
        
        // Update method chart
        function updateMethodChart(methodData) {
            const ctx = document.getElementById('methodChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (methodChart) {
                methodChart.destroy();
            }
            
            // Create chart
            methodChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: methodData.labels,
                    datasets: [{
                        label: 'Attendance by Method',
                        data: methodData.data,
                        backgroundColor: [
                            'rgba(67, 97, 238, 0.7)',
                            'rgba(32, 201, 151, 0.7)',
                            'rgba(253, 126, 20, 0.7)',
                            'rgba(111, 66, 193, 0.7)',
                            'rgba(23, 162, 184, 0.7)'
                        ],
                        borderColor: [
                            'rgb(67, 97, 238)',
                            'rgb(32, 201, 151)',
                            'rgb(253, 126, 20)',
                            'rgb(111, 66, 193)',
                            'rgb(23, 162, 184)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            
            // Create toast
            const toast = document.createElement('div');
            toast.className = 'toast-custom';
            
            // Set icon based on type
            let icon = 'info-circle';
            let bgColor = '#4361ee';
            
            switch(type) {
                case 'success':
                    icon = 'check-circle';
                    bgColor = '#4cc9f0';
                    break;
                case 'error':
                    icon = 'exclamation-circle';
                    bgColor = '#f72585';
                    break;
                case 'warning':
                    icon = 'exclamation-triangle';
                    bgColor = '#f8961e';
                    break;
            }
            
            toast.innerHTML = `
                <div class="toast-header-custom">
                    <div>
                        <i class="fas fa-${icon} me-2" style="color: ${bgColor}"></i>
                        <strong>${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                    </div>
                    <button type="button" class="btn-close" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
                <div class="toast-body-custom">
                    ${message}
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }
        
        // Show loading
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
        }
        
        // Hide loading
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }
        
        // Helper function to get initials from name
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }
        
        // Helper function to format date for datetime-local input
        function formatDateTimeLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }
        
        // Helper function to generate API key
        function generateApiKey() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let key = '';
            
            for (let i = 0; i < 32; i++) {
                key += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            return `gsams_${key}`;
        }
        
        // Generate mock analytics data
        function generateMockAnalytics(period) {
            const now = new Date();
            let labels = [];
            let trendData = [];
            
            switch(period) {
                case 'day':
                    // Last 24 hours
                    for (let i = 23; i >= 0; i--) {
                        const hour = new Date(now.getTime() - i * 60 * 60 * 1000);
                        labels.push(hour.getHours() + ':00');
                        trendData.push(Math.floor(Math.random() * 50) + 10);
                    }
                    break;
                    
                case 'week':
                    // Last 7 days
                    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    for (let i = 6; i >= 0; i--) {
                        const day = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
                        labels.push(days[day.getDay()]);
                        trendData.push(Math.floor(Math.random() * 200) + 50);
                    }
                    break;
                    
                case 'month':
                    // Last 30 days
                    for (let i = 29; i >= 0; i--) {
                        const day = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
                        labels.push(day.getDate());
                        trendData.push(Math.floor(Math.random() * 100) + 20);
                    }
                    break;
                    
                case 'year':
                    // Last 12 months
                    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    labels = months;
                    trendData = months.map(() => Math.floor(Math.random() * 1000) + 200);
                    break;
            }
            
            return {
                trend: {
                    labels,
                    data: trendData
                },
                methods: {
                    labels: ['GPS', 'SMS', 'USSD', 'Kiosk', 'Manual'],
                    data: [
                        Math.floor(Math.random() * 500) + 100,
                        Math.floor(Math.random() * 300) + 50,
                        Math.floor(Math.random() * 200) + 30,
                        Math.floor(Math.random() * 150) + 20,
                        Math.floor(Math.random() * 100) + 10
                    ]
                }
            };
        }
        
        // Check for updates
        function checkForUpdates() {
            // Check for service worker updates
            if (serviceWorkerRegistration) {
                serviceWorkerRegistration.update();
            }
            
            // Check for new features or announcements
            // This could be an API call in production
            setTimeout(() => {
                // Example: Show new feature announcement
                if (Math.random() > 0.7) {
                    showToast('New feature: Real-time monitoring is now available!', 'info');
                }
            }, 10000);
        }
        
        // Placeholder functions for actions
        function startMeeting(meetingId) {
            showToast('Starting meeting...', 'info');
            // In a real implementation, this would call the API
        }
        
        function viewAttendanceDetails(attendanceId) {
            showToast('Viewing attendance details...', 'info');
            // In a real implementation, this would show a modal with details
        }
        
        function verifyAttendance(attendanceId) {
            showToast('Verifying attendance...', 'info');
            // In a real implementation, this would call the API
        }
        
        function rejectAttendance(attendanceId) {
            if (confirm('Are you sure you want to reject this attendance?')) {
                showToast('Rejecting attendance...', 'info');
                // In a real implementation, this would call the API
            }
        }
        
        function editAdmin(adminId) {
            showToast('Editing admin...', 'info');
            // In a real implementation, this would show an edit modal
        }
        
        function deleteAdmin(adminId) {
            if (confirm('Are you sure you want to delete this admin?')) {
                showToast('Deleting admin...', 'info');
                // In a real implementation, this would call the API
            }
        }
    </script>
</body>
</html>